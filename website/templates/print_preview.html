{% extends 'base.html' %}

{% block title %} Print Preview {% endblock %}

<style type="text/css">
    table{
        font-family:Arial, Helvetica, sans-serif;
    }

    .bg-header{
        background-color: gray;
    }
    /* p>span{
        margin-left: 3px;
        margin-right: 6px;
    } */
    .my-font{
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
    }
    .my-font-size{
        font-size: 9px;
    }
    td{
        margin-bottom: 3px;
        font-size: 12px;
    }
    
</style>

{%block cssperfile %} 


<!-- Custom styles for this template -->

{% endblock %}

{% block content %}

<main class="container h-100 mt-5" id="pds" >

    <iframe id="pdf" style="width: 100%; height: 100%;" type="application/pdf" onload="loadingScreen('none')"></iframe>

</main>
{% endblock %}

{%block scripts%}
<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.js"></script> 

<script>
    
    window.addEventListener('load',(e)=>{
        console.log('loaded')
        fillForm();
        
    });

    async function fillForm() {

        const mainFormUrl = "{{ url_for('static', filename='my_pds_template2.pdf') }}";
        const mainFormPdfBytes = await fetch(mainFormUrl).then(res => res.arrayBuffer());
        const mainPdfDoc = await PDFLib.PDFDocument.load(mainFormPdfBytes);
    
        const mainForm = mainPdfDoc.getForm();

        const mainFields = mainForm.getFields();
        mainFields.forEach(field => {
         if(field instanceof PDFLib.PDFTextField){
            var myfield = mainForm.getTextField(field.getName());
            myfield.setText("HELLO");
            console.log(field.getName())
          }else{
            //console.log("not a text field");
           }

            //console.log(mainForm.getTextField(field.getName()));

            //console.log(field.getName());
            //console.log(field.getTextField());
        });
      
        mainForm.flatten();
    
      const pdfDataUri = await mainPdfDoc.saveAsBase64({ dataUri: true });
      document.getElementById('pdf').src = pdfDataUri;

    }

    async function personalInformation(){

    }
</script>
{%endblock%}