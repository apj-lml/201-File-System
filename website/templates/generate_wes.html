{% extends 'base.html' %}

{% block title %} Work Experience Sheet {% endblock %}

{%block cssperfile %}
<link href="{{ url_for('static', filename='movingBg.css') }}" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="{{url_for('static', filename='print-js/print.min.css')}}">

<style type="text/css">
    table{
        font-family:'Arial Narrow', sans-serif;
    }

    .my-font{
        font-family: 'Arial Narrow', Arial, sans-serif;
    }
    .my-font-size{
        font-size: 9px;
    }
    table>td{
        /* margin-bottom: 3px; */
        font-family: Arial, sans-serif;
        font-size: 12px;
    }
    table>tbody>tr>td>ul>li{
        padding: 0;
        margin-left: 40px;
    }
    .circle-bullet {
  list-style-type: circle;
}
</style>

<!-- <link href="{{ url_for('static', filename='movingBg.css') }}" rel="stylesheet"> -->

<!-- Custom styles for this template -->

{% endblock %}

{% block content %}
<ul class="circles">
  <li></li>
  <li></li>
  <li></li>
  <li></li>
  <li></li>
  <li></li>
  <li></li>
  <li></li>
  <li></li>
  <li></li>
</ul>

<main class="container-lg mt-3">
	<div class="row mb-3 ms-auto">

<!-- ----------------------------------------------------------------------- -->
<!--                             GENERATE WES                                -->
<!-- ----------------------------------------------------------------------- -->

<div class="card mb-3">
    <div class="card-body">
      <div class="card text-white bg-blue shadow-sm mb-3" >
        <div class="card-header">
          <h3 class="card-title"><i class="bi bi-file-earmark-text"></i> Work Experience Sheet </h3>
         </div>
        <div class="card-body">
          <ul>
          <li><p class="card-text">Please input all necessary fields.</p></li>
          <li><p class="card-text">File uploading only accepts PDF files. </p></li>
          </ul>
          <!-- <h5 class="card-title">Description</h5> -->
        </div>
      </div>


      <div class="accordion" id="accordionFlushExample">
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingOne">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
                View List of Work Experience
            </button>
          </h2>
          <div id="flush-collapseOne" class="accordion-collapse collapse show" aria-labelledby="flush-headingOne">
            <div class="accordion-body">
                
                <div class="card shadow-sm mb-3">
                    <div class="card-body">
                    <div class="d-md-flex flex-row table-responsive">
                        <div class="">
                            <table class="table table-bordered table-striped table-hover" id="work_experience_table">
                                <thead class="text-center">
                                <tr class="align-middle">
                                <th colspan="2">Inclusive Dates</th>
                                <th rowspan="2">Position Title</th>
                                <th rowspan="2">Status</th>
                                <!-- <th rowspan="2">SG</th>
                                <th rowspan="2">Step</th> -->
                                <th rowspan="2">Agency / Company</th>
                                <th rowspan="2">Department / Office</th>
                                <th rowspan="2">Agency / Company Address</th>
                                <th rowspan="2">Immediate Supervisor</th>
                                <!-- <th rowspan="2">Monthly Salary</th>
                                <th rowspan="2">Salary / Job / Pay Grade</th>
                                <th rowspan="2">Status of Appointment</th>
                                <th rowspan="2" class="truncate">Government Service</th> -->
                                <th rowspan="2">Controls</th>
                                </tr>
                                <tr class="align-middle">
                                <th style="word-wrap: break-word; min-width:40px; max-width:40px; white-space:normal;"> (From)</th>
                                <th style="word-wrap: break-word; min-width:40px; max-width:40px; white-space:normal;"> (To)</th>
                
                                </tr>
                                </thead>
                                <tbody>
                                {# if user_profile.work_experience is not none #}
                                    {% for work_experience in user_profile.work_experience %}
                                    <tr>
                                        <td>{{work_experience.date_from|format_mydatetime}}</td>
                                        <td>{{work_experience.date_to|format_mydatetime}}</td>
                                        <td style="word-wrap: break-word; min-width:160px; max-width:160px; white-space:normal;">{{work_experience.position_title}}</td>
                                        <td style="word-wrap: break-word; min-width:120px; max-width:120px; white-space:normal;">{{work_experience.status_of_appointment}}</td>
                                        <!-- <td style="word-wrap: break-word; min-width:60px; max-width:60px; white-space:normal;">{{work_experience.sg}}</td>
                                        <td style="word-wrap: break-word; min-width:60px; max-width:60px; white-space:normal;">{{work_experience.step}}</td> -->
                                        <td>{{work_experience.department_agency_office_company}}</td>
                                        <td>{{work_experience.name_of_office_unit}}</td>
                                        <td>{{work_experience.agency_address}}</td>
                                        <td>{{work_experience.immediate_supervisor}}</td>
                
                                        <!-- <td>{{work_experience.monthly_salary}}</td>
                                        {% if work_experience.sg == 'N/A' %}
                                        <td>N/A</td>
                                        {% else %}
                                        <td>{{ '%02d' % work_experience.sg|int}} - {{work_experience.step}}</td>
                                        {% endif %}
                                        <td>{{work_experience.status_of_appointment}}</td>
                                        <td>{{work_experience.govt_service}}</td> -->
                                        <td class="text-center"><div class="d-sm-flex flex-row text-center">
                                        <a class="btn btn-primary btn-sm m-2" title="View" id="{{work_experience.id}}" data-bs-toggle="modal" data-bs-target="#viewExpModal" onclick = "view_work_experience(this)">
                                            Accomplishments & Actual Duties
                                        </a>
                                        </div></td>
                                    </tr>
                                    {% endfor %}
                                {# endif #}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>

            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingTwo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwo" aria-expanded="false" aria-controls="flush-collapseTwo">
              View Work Experience Sheet
            </button>
          </h2>
          <div id="flush-collapseTwo" class="accordion-collapse collapse show" aria-labelledby="flush-headingTwo">
            <div class="accordion-body">

                
      <div class="card shadow-sm mb-3">
        <div class="card-body">
            <a class="btn btn-primary btn-sm mb-3" href="#" onclick="generate_wes()">Generate WES (.docx)</a>
            <a class="d-none" href="/gen/{{user_profile.id}}" id="clickMe">Click me</a>
          <div class="d-md-flex flex-row">
            <div class="container" id="wes">
                <div class="fw-bold fst-italic my-font mb-5">Attachment to CS Form No. 212</div>
                <table class="table table-bordered border border-dark">
                    <thead>
                        <tr>
                            <th scope="col" class="text-center p-0" style="background-color: #969696;"><h6 class="fst-italic p-0 m-0" style="color:white;">WORK EXPERIENCE SHEET</h6></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td scope="row" class="fst-italic" style="background-color: #eaeaea;">
                                <div class="row">
                                    <div class="col-md-auto">
                                        <i class="fw-bold">Instructions:</i>
                                    </div>
                                    <div class="col">
                                        <p>1. Include only the work experiences relevant to the position being applied to.</p>
                                        <p class="mb-0">2. The duration should include start and finish dates, if known, month in abbreviated form,
                                            if known, and year in full. For the current position, use the word Present, e.g., 1998-Present.
                                            Work experience should be listed from most recent first.</p>
                                    </div>
                                </div>

                            </td>
                        </tr>
                        {% for work_experience in user_profile.work_experience %}
                        <tr>
                            <td>
                                <ul>
                                    <ul>
                                        <li>
                                            Duration: {{work_experience.date_from|format_mydatetime_2}} -  {{work_experience.date_to|format_mydatetime_2}}
                                        </li>
                                        <li>
                                            Position: {{work_experience.position_title}} ({{ work_experience.status_of_appointment }})
                                        </li>
                                        <li>
                                            Name of Office/Unit: {{work_experience.name_of_office_unit}}
                                        </li>
                                        <li>
                                            Immediate Supervisor: {{work_experience.immediate_supervisor}}
                                        </li>
                                        <li>
                                            Name of Agency/Organization and Location: {{work_experience.department_agency_office_company}}, {{work_experience.agency_address}}
                                        </li>
                                        <ul class="mt-2">
                                            <li class="circle-bullet">List of Accomplishments and Contributions (if any)</li>
                                                <ul id="wes_accomplishment{{work_experience.id}}">
                                                        {% if work_experience.wda|length > 0 %}
                                                            {% set testing_accomp = namespace(value=0) %}

                                                            {% for accomp in work_experience.wda %}
                                                                {% if accomp.wda_type == 'accomplishment' %}
                                                                    <li class="circle-bullet" id="wes_accomplishment_list{{accomp.id}}">{{accomp.wda}}</li>
                                                                    {% set testing_accomp.value = testing_accomp.value  + 1 %}
                                                                {% endif %}

                                                            {% endfor %}
                                                            
                                                            {% if testing_accomp.value < 1 %}
                                                                <li class="circle-bullet" id="">N/A</li>
                                                            {% endif %}

                                                        {% else %}
                                                            <li class="circle-bullet" id="">N/A</li>

                                                        {% endif %}
                                                </ul>
                                        </ul>
                                        <ul class="mt-4">
                                            <li class="circle-bullet">Summary of Actual Duties</li>
                                         
                                                <ul id="wes_summary{{work_experience.id}}">
                                                        {% if work_experience.wda|length > 0 %}
                                                            {% set testing = namespace(tvalue=0) %}

                                                            {% for summary in work_experience.wda %}
                                                                {% if summary.wda_type == 'summary' %}
                                                                    <li class="circle-bullet" id="wes_summary_list{{summary.id}}">{{summary.wda}}</li>
                                                                    {% set testing.tvalue = testing.tvalue + 1 %}
                                                                {% endif %}

                                                            {% endfor %}

                                                            {% if testing.tvalue < 1 %}
                                                                <li class="circle-bullet" id="">N/A</li>
                                                            {% endif %}
                                                         
                                                    {% else %}
                                                        <li class="circle-bullet" id="">N/A</li>

                                                    {% endif %}
                                                </ul>
                                        </ul>
                                    </ul>
                                </ul>
                            </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
          </div>
        </div>
      </div>
                
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>

</div>

</main>


<!-- ----------------------------------------------------------------------- -->
<!--                                 Modals                                  -->
<!-- ----------------------------------------------------------------------- -->

<!-- Modal -->
<div class="modal fade" id="editAccompModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">Edit Accomplishment</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="col-md-12">
                <div class="mb-3">
                    <form action="#" method="POST" name="edit_accomp_form" id="edit_accomp_form"></form>
                    <label for="edit_wda_accomp" class="form-label">List of Accomplishments</label>
                    <textarea class="form-control" id="edit_wda_accomp" name="wda" form="edit_accomp_form" rows="7" required></textarea>
                    <input type="hidden" name="wda_type" id="edit_wda_type" value="accomplishment" form="edit_accomp_form">
                    <input type="hidden" name="we" id="edit_we" form="edit_accomp_form">
                    <input type="hidden" name="id" id="edit_wda_id" form="edit_accomp_form">
                </div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" form="edit_accomp_form">Save changes</button>
        </div>
      </div>
    </div>
  </div>

<div class="modal fade" id="viewExpModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="viewExpModal" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-fullscreen-sm-down">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="viewExpModal">Accomplishments and Actual Duties</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3 container">
            <!-- <div class="card mb-3">
                <div class="card-body">
                  <h3 class="card-title"><i class="bi bi-journals"></i> Work Experience</h3> -->
                  <form action="#" method="POST" name="update_work_experience_form" id="update_work_experience_form" enctype="multipart/form-data"></form>
                  <input type="hidden" class="form-control" name ="id" id="update_id" placeholder="" value="" form="update_work_experience_form">
  
                      <div class="card shadow-sm">
                          <div class="card-body">

                            <table class="table table-bordered border border-dark">
                                <thead>
                                    <tr>
                                        <th scope="col" class="text-center p-0" style="background-color: #969696;"><h6 class="fst-italic p-0 m-0" style="color:white;">WORK EXPERIENCE SHEET</h6></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td scope="row" class="fst-italic" style="background-color: #eaeaea;">
                                            
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <form action="#" method="POST" name="add_accomp_form" id="add_accomp_form"></form>
                                                        <label for="wda_accomp" class="form-label">List of Accomplishments</label>
                                                        <textarea class="form-control" id="wda_accomp" name="wda" form="add_accomp_form" rows="7" required></textarea>
                                                        <input type="hidden" name="wda_type" id="" value="accomplishment" form="add_accomp_form">
                                                        <input type="hidden" name="we" id="we_accomp" form="add_accomp_form">
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="mb-3">
                                                        <form action="#" method="POST" name="add_actual_duties_form" id="add_actual_duties_form"></form>
                                                        <label for="wda_actual_duties" class="form-label">Summary of Actual Duties</label>
                                                        <textarea class="form-control" id="wda_actual_duties" name="wda" form="add_actual_duties_form" rows="7" required></textarea>
                                                        <input type="hidden" name="wda_type" id="" value="summary" form="add_actual_duties_form">
                                                        <input type="hidden" name="we" id="we_summary" form="add_actual_duties_form">

                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="d-flex justify-content-start">
                                                        <button type="submit" class="btn btn-primary btn-sm" form="add_accomp_form">
                                                                Add Accomplishments
                                                        </button>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="d-flex justify-content-start">
                                                        <button type="submit" class="btn btn-primary btn-sm" form="add_actual_duties_form">
                                                                Add Actual Duties
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
            
                                        </td>
                                    </tr>
                                   
                                    <tr>
                                        <td>
                                            <ul>
                                                <ul>
                                                    <li>
                                                        <div class="d-flex flex-row bd-highlight">
                                                            Duration: <div id="update_date_from"></div>&nbsp;-&nbsp;<div id="update_date_to"></div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="d-flex flex-row bd-highlight">
                                                            Position: <div id="update_position_title"></div>&nbsp;(<div id="update_status_of_appointment"></div>)
                                                             
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="d-flex flex-row bd-highlight">
                                                            Name of Office/Unit: <div id="update_name_of_office_unit"></div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="d-flex flex-row bd-highlight">
                                                            Immediate Supervisor: <div id="update_immediate_supervisor"></div>
                                                        </div>
                                                    </li>
                                                    <li>
                                                        <div class="">
                                                            Name of Agency/Organization and Location: <div id="update_department_agency_office_company" style="display: inline;"></div>, <div id="update_agency_address" style="display: inline;"></div>

                                                        </div>
                                                     
                                                    </li>
                                                    <ul>
                                                        <li class="circle-bullet">List of Accomplishments and Contributions (if any)</li>
                                                            <ul id="list_of_accomplishments">
                                                                <!-- <li class="circle-bullet"></li>
                                                                <li class="circle-bullet"></li> -->
                                                            </ul>
                                                    </ul>
                                                    <ul>
                                                        <li class="circle-bullet">Summary of Actual Duties</li>
                                                            <ul id="list_of_summary">
                                                                <!-- <li class="circle-bullet"></li> -->
                                                            </ul>
                                                    </ul>
                                                </ul>
                                            </ul>
                                        </td>
                                    </tr>

            
                                </tbody>
                            </table>
                            
  
                          </div>
                      </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <!-- <button type="submit" class="btn btn-primary" form="update_work_experience_form">Save changes</button> -->
        <!-- </div>
      </div> -->
    </div>
  </div>
  </div>
  </div>
  </div>


{% endblock %}
      
{%block scripts%}
<script src="{{ url_for('static', filename='html2pdf/html2pdf.bundle.min.js') }}"></script>
<script src="{{ url_for('static', filename='print-js/print.min.js') }}"></script>

<script type="text/javascript">

function print_wes(){
        printJS({
        'printable':'wes',
        'type':'html',
        'scanStyles':'false',
        
        })
    }

function print_wes_html2pdf(){
        var element = document.getElementById('wes');
        var worker = html2pdf();

        var opt = {
            margin: .05,
            filename:     'wes.pdf',
            image:        { type: 'png' },
            html2canvas:  { scale: 2, scrollY: 0 },
            jsPDF:        { unit: 'in', format: 'A4', orientation: 'portrait' },
            // pagebreak: {mode: 'avoid-all'},
            };

        worker.from(element).set(opt).save();
        // html2pdf(element);
    }

function convert_date(dateStr){
    let formatted_date;
    if(dateStr == "PRESENT"){
        formatted_date = dateStr;
    }else{
        let date_to = new Date(dateStr);
        let dtye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(date_to);
        let dtmo = new Intl.DateTimeFormat('en', { month: 'long' }).format(date_to);
        let dtda = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(date_to);
        formatted_date = `${dtmo} ${dtda}, ${dtye}`;

    }
    return formatted_date
}

function view_work_experience(el){

    fetch('/workExperience/view-work-experience',{
        method: 'POST',
        body: JSON.stringify({"work_exp_id" : el.id})
    })
        .then(response => response.json())
        .then(data => {
            console.log(data)
            document.getElementById('update_id').innerHTML = data[0].id;


            let date_from = new Date(data[0].date_from);
            let ye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(date_from);
            let mo = new Intl.DateTimeFormat('en', { month: 'long' }).format(date_from);
            let da = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(date_from);

            if(data[0].date_to == "PRESENT"){
                document.getElementById('update_date_to').innerHTML = data[0].date_to;
            }else{
                let date_to = new Date(data[0].date_to);
                let dtye = new Intl.DateTimeFormat('en', { year: 'numeric' }).format(date_to);
                let dtmo = new Intl.DateTimeFormat('en', { month: 'long' }).format(date_to);
                let dtda = new Intl.DateTimeFormat('en', { day: '2-digit' }).format(date_to);

                document.getElementById('update_date_to').innerHTML =  `${dtmo} ${dtda}, ${dtye}`
            }


            document.getElementById('update_date_from').innerHTML = `${mo} ${da}, ${ye}`

            
            document.getElementById('update_position_title').innerHTML = data[0].position_title;
            document.getElementById('update_status_of_appointment').innerHTML = data[0].status_of_appointment;
            document.getElementById('update_department_agency_office_company').innerHTML = data[0].department_agency_office_company;

            document.getElementById('update_name_of_office_unit').innerHTML = data[0].name_of_office_unit;
            document.getElementById('update_agency_address').innerHTML = data[0].agency_address;
            document.getElementById('update_immediate_supervisor').innerHTML = data[0].immediate_supervisor;

            document.getElementById('we_accomp').value = data[0].id;
            document.getElementById('we_summary').value = data[0].id;

            document.getElementById('list_of_accomplishments').innerHTML = "";
            document.getElementById('list_of_summary').innerHTML = "";

            data[0].wda.forEach(accomp => {
                if(accomp.wda_type == "accomplishment"){
                    document.getElementById('list_of_accomplishments').innerHTML += `<li class="circle-bullet" id="wda${accomp.id}"> ${accomp.wda} - <a data-bs-toggle="modal" data-bs-target="#editAccompModal" href="#" id="${accomp.id}" onclick="editAccomp(this, 'accomplishment');"><i class="bi bi-pencil"></i></a> | <a href="#" class="" id="${accomp.id}" onclick="deleteAccomp(this, 'accomplishment', ${data[0].id});"><i class="bi bi-trash text-danger"></i></a></li>`;
                }else if(accomp.wda_type == "summary"){
                    document.getElementById('list_of_summary').innerHTML += ` <li class="circle-bullet" id="summary${accomp.id}"> ${accomp.wda} - <a data-bs-toggle="modal" data-bs-target="#editAccompModal" href="#" id="${accomp.id}" onclick="editAccomp(this,'summary');"><i class="bi bi-pencil"></i></a> | <a href="#" id="${accomp.id}" onclick="deleteAccomp(this,'summary', ${data[0].id});"><i class="bi bi-trash text-danger"></i></a> </li>`;
                }
            });


        });
}


function listOfEmptyFields(arr){
    var html = '';
    for(var x = 0; x<arr.length; x++){
        if(arr[x] == "agency_address"){
            arr[x] = "Agency / Company Address";
        }else if(arr[x] == "immediate_supervisor"){
            arr[x] = "Immediate Supervisor";
        }else if(arr[x] == "name_of_office_unit"){
            arr[x] = "Department / Office";
        }
        html += `
            <p class='mb-0'><b>Please also fill out:</b></p>
            <li>
                ${arr[x]}
            </li>
        `;
    }
    return html;
}

function generate_wes(){
    console.log('{{user_profile.id}}')
    let empty_field = []
    fetch(`/check-before-gen/{{user_profile.id}}`,{
        method: 'GET',
        // body: JSON.stringify({"accomp_id" : el.id})
        })
        .then(response => response.json())

        .then(data => {
            console.log(data)

            if(data != '200'){
                // var result = Object.keys(data).find(key=> (data[key] === '' || data[key] === null));
       
                // var result = Object.keys(data).filter(item =>item.value === '' || item.value === null)

                for (var key in data) {
                    
                    if(data[key] == "" || data[key] == null)
                    empty_field.push(key)
                    // for (var prop in obj.line[key]) {
                    //     result.innerHTML += "<br/>" + prop + " = " + obj.line[key][prop];
                    // }
                }

                console.log(empty_field)


                    Swal.fire({
                        title: '<strong>Generate WES Failed!</strong>',
                        icon: 'error',
                        html:
                            `<p class='mb-0'>Please make sure that <b><i>Accomplishments & Actual Duties</b></i> are filled out for Work Experience with the
                            <br><b>Inclusive date of:</b></p> 
                            
                            <p>${convert_date(data.date_from)} - ${convert_date(data.date_to)}</p>

                           
                            ${ listOfEmptyFields(empty_field) }
                            `,
                        showCloseButton: true,
                        focusConfirm: true,
                        confirmButtonText:
                            '<i class="fa fa-thumbs-up"></i> OK!',
                        confirmButtonAriaLabel: 'OK!',
      
                        })



            }else{
                // console.log(all_data)
                // if(all_data.agency_address){
                //     Swal.fire({
                //         title: '<strong>Generate WES Failed!</strong>',
                //         icon: 'error',
                //         html:
                //             `<p>Please make sure that all your inputs are complete for Work Experience with the
                //             <b>Inclusive dates of:</b></p> <p>${convert_date(data.date_from)} - ${convert_date(data.date_to)}</p>
                //             `,
                //         showCloseButton: true,
                //         focusConfirm: true,
                //         confirmButtonText:
                //             '<i class="fa fa-thumbs-up"></i> OK!',
                //         confirmButtonAriaLabel: 'OK!',
      
                //         })
                // }else{
                    // console.log("Click me ")
                    document.getElementById('clickMe').click();
                // }
            }

            

        });
    }

function editAccomp(el, wda_type){
    // console.log(el.id)
    fetch(`/wes/edit-accomp/${el.id}`,{
        method: 'POST',
        body: JSON.stringify({"accomp_id" : el.id})
        })
        .then(response => response.json())

        .then(data => {
            // console.log(data)
            document.getElementById('edit_wda_id').value = data.id;

            document.getElementById('edit_wda_accomp').value = data.wda;
            document.getElementById('edit_wda_type').value = data.wda_type;
            document.getElementById('edit_we').value = data.we;
            
        });
}

function isEmptyAccomp(id){
    return document.getElementById(id).innerHTML.trim() == "";
}

function deleteAccomp(el, wda_type, wda_id){

    Swal.fire({
    title: 'Are you sure you want to delete this?',
    text: "You won't be able to revert this!",
    icon: 'warning',
    showCancelButton: true,
    //   confirmButtonColor: '#3085d6',
    //   cancelButtonColor: '#d33',
    confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
    if (result.isConfirmed) {

        fetch('/wes/delete-accomp',{
            method: 'POST',
            body: JSON.stringify({"accomp_id" : el.id})
            })
            .then(response => {
            if(response.status == '200'){
                if(wda_type == "summary"){
                    // fade(document.getElementById('summary'+el.id));
                    // fade(document.getElementById('wes_summary_list'+el.id));

                    document.getElementById('summary'+el.id).remove();
                    document.getElementById('wes_summary_list'+el.id).remove();

                    if(isEmptyAccomp('wes_summary'+el.id)){
                        document.getElementById('wes_summary'+wda_id).innerHTML == "<li class='circle-bullet'>N/A<li>";
                    }
                }else{
                    fade(document.getElementById('wda'+el.id));
                    fade(document.getElementById('wes_accomplishment_list'+el.id));


                }
                // document.getElementById('wda'+el.id).remove();
            }
            return response.json()

            })
            .then(data => {

            });

        Swal.fire(
        'Deleted!',
        'Successfully deleted.',
        'success'
        )
    }
    })

  }


    document.getElementById('add_accomp_form').addEventListener('submit',(e)=>{
            e.preventDefault();
            let formData1 = new FormData(document.getElementById("add_accomp_form"));
          
            const data1 = {}
                formData1.forEach((value, key) => (data1[key] = value));
            fetch('/wes/add-accomp', {
                method: 'POST',
                body: formData1
                }).then(response => response.json())
                .then((data)=>{
                    console.log("date.we ng wes_accomplishment: ", data.we);

                    if(data.wda_type == "accomplishment"){
                        console.log("date.we ng wes_accomplishment: ", data.we);

                        document.getElementById('list_of_accomplishments').innerHTML += `<li class="circle-bullet" id="wda${data.id}"> ${data.wda} - <a data-bs-toggle="modal" data-bs-target="#editAccompModal" href="#" id="${data.id}" onclick="editAccomp(this, 'accomplishment');"><i class="bi bi-pencil"></i></a> | <a href="#" id="${data.id}" onclick="deleteAccomp(this, 'accomplishment')"> <i class="bi bi-trash text-danger"></i></a></li>`;
                        document.getElementById('wes_accomplishment'+data.we).innerHTML += `<li class="circle-bullet" id="wes_accomplishment_list${data.id}"> ${data.wda}</li>`;
                   
                    }
                    document.getElementById("wda_accomp").value = "";
                    

                });//END
            });

        document.getElementById('edit_accomp_form').addEventListener('submit',(e)=>{
            e.preventDefault();
            let formData1 = new FormData(document.getElementById("edit_accomp_form"));
          
            const data1 = {}
                formData1.forEach((value, key) => (data1[key] = value));
            fetch('/wes/update-accomp', {
                method: 'POST',
                body: formData1
                }).then((res)=>{
              
                  return res.json()
                
                }).then((data)=>{
                    Swal.fire(
                    'Saved!',
                    'Successfully updated.',
                    'success'
                    )
                    window.location.reload();

                });//END
            });

    document.getElementById('add_actual_duties_form').addEventListener('submit',(e)=>{
            e.preventDefault();
            let formData1 = new FormData(document.getElementById("add_actual_duties_form"));
          
            const data1 = {}
                formData1.forEach((value, key) => (data1[key] = value));
            // console.log(data1)
            fetch('/wes/add-accomp', {
                method: 'POST',
                body: formData1
                }).then((res)=>{
              
                  return res.json()
                
                }).then((data)=>{

                  if(data.wda_type == "summary"){
                        document.getElementById('list_of_summary').innerHTML += `<li class="circle-bullet" id="summary${data.id}"> ${data.wda} -  <a data-bs-toggle="modal" data-bs-target="#editAccompModal" href="#" id="${data.id}" onclick="editAccomp(this, 'accomplishment');"><i class="bi bi-pencil"></i></a> | <a href="#" id="${data.id}" onclick="deleteAccomp(this,'summary', ${data.id})"> <i class="bi bi-trash text-danger"></i> </a></li>`;
                        document.getElementById('wes_summary'+data.we).innerHTML += `<li class="circle-bullet" id="wes_summary_list${data.id}"> ${data.wda}</li>`;
                        
                    }
                    document.getElementById("wda_actual_duties").value == "";

                });//END

                document.getElementById("wda_actual_duties").value = ""

            });


  function fade(element) {
    var op = 1;  // initial opacity
    var timer = setInterval(function () {
        if (op <= 0.1){
            clearInterval(timer);
            element.remove();
            // element.style.display = 'none';
        }
        element.style.opacity = op;
        element.style.filter = 'alpha(opacity=' + op * 100 + ")";
        op -= op * 0.1;
    }, 50);
}





</script>

{% endblock %}