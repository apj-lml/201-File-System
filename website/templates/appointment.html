{% extends 'base.html' %}

{% block title %} Admin Dashboard {% endblock %}

{%block cssperfile %} 
<style>
	.dtsb-titleRow{
		display: none;
	}
</style>


<link href="{{ url_for('static', filename='movingBg.css') }}" rel="stylesheet">


{% endblock %}

{% block content %}
<main class="container-fluid mt-4">
		<ul class="circles">
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
	<div class="container-fluid">
		<div class="card shadow-sm mt-3">
			<div class="card-body">
				<!-- <div class="col-sm-12"> -->
					<div class="card text-white bg-blue shadow-sm mb-0" >
						<div class="card-header"><h3 class="card-title"><i class="bi bi-card-heading"></i> Appointments</h3> </div>
						<div class="card-body">
						  <ul>
							<li><p class="card-text">Please input all necessary fields.</p></li>
							<li><p class="card-text">Check the PRESENT checkbox to indicate that your appointment is currently effective.</p></li>
							<li><p class="card-text">File uploading only accepts PDF files. </p></li>
						  </ul>
						  <!-- <h5 class="card-title">Description</h5> -->
						  
						</div>
					</div>
						<div class="col-sm-12">
							<button class="btn btn-primary btn-sm mt-5 mb-3" data-bs-toggle="modal" data-bs-target="#exampleModal">Add Record</button>
						</div>
					<div class="table-responsive">
						<table class="table table-striped table-bordered text-center display" id="service_record_table" style="width: 100%;">
							<thead>
							<tr class="align-middle">
								<th  colspan="2">EMPLOYMENT PERIOD <i>(Inclusive Dates)</i></th>
								<th  colspan="3">RECORD OF APPOINTMENT</th>
								<th  rowspan="2">STATION/PLACE OF ASSIGNMENT</th>
								<!-- <th  rowspan="2">LEAVE W/O PAY</th> -->
								<!-- <th  colspan="2">SEPARATION</th> -->
								<th  rowspan="2">ATTACHMENT</th>
								<th  rowspan="2">CONTROLS</th>
							</tr>
							<tr class="align-middle">
								<th >FROM</th>
								<th >TO</th>
								<th >POSITION TITLE</th>
								<th >EMPLOYMENT STATUS</th>
								<th >DAILY/MONTHLY RATE</th>
								<!-- <th >DATE</th>
								<th >CAUSE</th> -->
							</tr>
							</thead>
							<tbody>
			
							</tbody>
						</table>
					</div>
				<!-- </div> -->
		</div>
		</div>

			<!-- <div class="card shadow-sm mt-3">
				<div class="card-body">
				  <table class="table table-bordered table-striped" id="uploaded_file_table">
					<thead>
					  <tr>
						<th>File Name</th>
						<th>File Tag</th>
						<th>Controls</th>
					  </tr>
					  </thead>
					  <tbody>
					{% for file in user_profile.uploaded_files %}
						{% if file.file_tag == 'appointment' %}
						<tr>
						  <td><a href="{{file.file_path}}\{{file.file_name}}" target="_blank">{{file.file_name}}</a></td>
						  <td>{{file.file_tag}}</td>
						  <td>
							<a class="btn btn-danger btn-sm m-2" title="Remove" id="{{file.id}}" onclick = "delete_file(this)">
							  <i class="bi bi-trash"></i>
							</a>
						  </td>
						</tr>
	  
						{% endif %}
					{% endfor %}
				  </tbody>
				  </table>
				</div>
			  </div> -->



		<!-- <div class="row">
			<div class="col-sm-12">
				<p class="fw-light mb-0">This superseeds all Service Records previously issued inconsistent herewith.</p>
				<p class="fw-bold">INVALID IF THERE ARE ERASURES.</p>
			</div>
			<div class="col-sm-12 mt-3">
				<p><i>Certified Correct:</i></p>
			</div>
			<div class="col-sm-12 mt-5">
				<p class="fw-bold mb-0">FRANCIS CARLO L. ZACARIAS</p>
				<p class="mt-0"><i>Industrial Relations Management/Development Officer C</i></p>
			</div>
		</div> -->
	</div>

</main>

<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static">
	<div class="modal-dialog modal-dialog-scrollable modal-lg">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title"><i class="bi bi-card-list"></i> Appointment</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body">
			<form enctype="multipart/form-data" id="add_service_record" action="/appointment/add-appointment/{{current_user.id}}" method="POST" autocomplete="off" class="needs-validation" novalidate>
				<div class="d-sm-flex flex-row"> 
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="date" class="form-control" id="service_from" name ="service_from" placeholder="Service From" value="" required>
					  <label for="service_from">Service From</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="date" class="form-control" id="service_to" name ="service_to" placeholder="Service To" value="" required>
					  <label for="first_name">Service To</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					  <div class="form-check">
						<input class="form-check-input" type="checkbox" id="sf_present" name="sf_present" value = "Present">
						<label class="form-check-label" for="sf_present">
						  PRESENT
						</label>
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row"> 
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="text" class="form-control" id="designation" name ="designation" placeholder="Designation" value="" required>
					  <label for="designation">Designation</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
						<select class="form-select" id="status" name="status" aria-label="Floating label select example" value="">
							<option value="Job Order">Job Order</option>
							<option value="Permanent">Permanent</option>
							<option value="Casual">Casual</option>
							<option value="Coterminous">Coterminous</option>
							<option value="Separated">Separated</option>
						</select>
						<label for="middle_name">Employment Status</label>

						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
					</div>
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="number" class="form-control" id="salary" name ="salary" placeholder="Salary" value="" required>
					  <label for="salary">Salary</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
						<input type="text" class="form-control" id="station_place" name ="station_place" placeholder="Station/ Place of Assignment" value="" required>
						<label for="designation">Station/ Place of Assignment</label>
						<div class="form-check">
							<input class="form-check-input" type="checkbox" id="nia_pimo" name="nia_pimo" value = "NATIONAL IRRIGATION ADMINISTRATION - PANGASINAN IRRIGATION MANAGEMENT OFFICE">
							<label class="form-check-label" for="nia_pimo">
							  NATIONAL IRRIGATION ADMINISTRATION - PANGASINAN IRRIGATION MANAGEMENT OFFICE
							</label>
						  </div>
						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
					</div>
					<!-- <div class="form-floating flex-fill mb-3 p-1">
					  <input type="text" class="form-control" id="leave_wo_pay" name ="leave_wo_pay" placeholder="Leave W/O Pay" value="None">
					  <label for="salary">Leave W/O Pay</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div> -->
				</div>
				<!-- <div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
						<input type="date" class="form-control" id="separation_date" name ="separation_date" placeholder="Separation Date" value="">
						<label for="designation">Separation Date</label>
						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
					</div>
				</div> -->
				<!-- <div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
					  <textarea rows="5" style="height:100%;" cols="50" class="form-control" id="separation_cause" name ="separation_cause" placeholder="Separation Cause" value=""></textarea>
					  <label for="salary">Separation Cause</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
				</div> -->
				<div class="d-sm-flex flex-row">
					<div class="flex-fill mb-3 p-1">
                        <label for="diploma" class="form-label">Upload Appointment</label>
                        <input class="form-control" type="file" id="appointment" name="appointment" required>
						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
                      </div>
					<!-- <div class="form-floating flex-fill mb-3 p-1">
						<input class="form-control" type="file" id="appointment" name="appointment" multiple>
						<label for="salary">Upload Appointment</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div> -->
				</div>

		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		  <button type="submit" class="btn btn-primary">Save Record</button>
		</form>
		</div>
	  </div>
	</div>
  </div>


  <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" data-bs-backdrop="static">
	<div class="modal-dialog modal-dialog-scrollable modal-lg">
	  <div class="modal-content">
		<div class="modal-header">
		  <h5 class="modal-title"><i class="bi bi-card-list"></i> Edit Appointment</h5>
		  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		</div>
		<div class="modal-body">
			<form enctype="multipart/form-data" id="update_service_record" action="/appointment/update-appointment/{{current_user.id}}" method="POST" autocomplete="off" class="needs-validation" novalidate>
				<input type="text" class="form-control" id="id" name ="id" placeholder="id" value="" required>
				
				<div class="d-sm-flex flex-row"> 
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="date" class="form-control" id="update_service_from" name ="service_from" placeholder="Service From" value="" required>
					  <label for="update_service_from">Service From</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="date" class="form-control" id="update_service_to" name ="service_to" placeholder="Service To" value="" required>
					  <label for="update_service_to">Service To</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					  <div class="form-check">
						<input class="form-check-input" type="checkbox" id="update_sf_present" name="sf_present" value = "Present">
						<label class="form-check-label" for="update_sf_present">
						  PRESENT
						</label>
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row"> 
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="text" class="form-control" id="update_designation" name ="designation" placeholder="Designation" value="" required>
					  <label for="update_designation">Designation</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
						<select class="form-select" id="update_status" name="status" aria-label="Floating label select example" value="">
							<option value="Job Order">Job Order</option>
							<option value="Permanent">Permanent</option>
							<option value="Casual">Casual</option>
							<option value="Coterminous">Coterminous</option>
							<option value="Separated">Separated</option>
						</select>
						<label for="update_status">Employment Status</label>

						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
					</div>
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="number" class="form-control" id="update_salary" name ="salary" placeholder="Salary" value="" required>
					  <label for="update_salary">Salary</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
						<input type="text" class="form-control" id="update_station_place" name ="station_place" placeholder="Station/ Place of Assignment" value="" required>
						<label for="update_designation">Station/ Place of Assignment</label>
						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
					</div>
					<div class="form-floating flex-fill mb-3 p-1">
					  <input type="text" class="form-control" id="update_leave_wo_pay" name ="leave_wo_pay" placeholder="Leave W/O Pay" value="None">
					  <label for="update_leave_wo_pay">Leave W/O Pay</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
						<input type="date" class="form-control" id="update_separation_date" name ="separation_date" placeholder="Separation Date" value="">
						<label for="update_separation_date">Separation Date</label>
						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row">
					<div class="form-floating flex-fill mb-3 p-1">
					  <textarea rows="5" style="height:100%;" cols="50" class="form-control" id="update_separation_cause" name ="separation_cause" placeholder="Separation Cause" value=""></textarea>
					  <label for="update_separation_cause">Separation Cause</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div>
				</div>
				<div class="d-sm-flex flex-row">
					<div class="flex-fill mb-3 p-1">
                        <label for="diploma" class="form-label">Upload Appointment</label>
                        <input class="form-control" type="file" id="update_appointment" name="appointment" required>
						<div class="valid-feedback">
							Looks good!
						  </div>
						  <div class="invalid-feedback">
							This is required.
						  </div>
                      </div>
					<!-- <div class="form-floating flex-fill mb-3 p-1">
						<input class="form-control" type="file" id="appointment" name="appointment" multiple>
						<label for="salary">Upload Appointment</label>
					  <div class="valid-feedback">
						Looks good!
					  </div>
					  <div class="invalid-feedback">
						This is required.
					  </div>
					</div> -->
				</div>

		</div>
		<div class="modal-footer">
		  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
		  <button type="submit" class="btn btn-primary">Save Record</button>
		</form>
		</div>
	  </div>
	</div>
  </div>

{% endblock %}

{%block scripts%}
<script type="text/javascript">

window.addEventListener("load", ()=>{

	$('#uploaded_file_table').DataTable({
      responsive: true,
        dom: 'ftrip'
        // dom: `Q<'row'<'col-sm-4 col-md-4'l><'col-sm-4 col-md-4'><'col-sm-4 col-md-4'f>>
				// <'row'<'col-sm-12'tr>>
				// <'row'<'col-sm-12 col-md-5'><'col-sm-12 col-md-7'p>>`,
    });

  // Fetch all the forms we want to apply custom Bootstrap validation styles to
  var forms = document.querySelectorAll('.needs-validation')

  // Loop over them and prevent submission
  Array.prototype.slice.call(forms)
    .forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault()
          event.stopPropagation()
        }

        form.classList.add('was-validated')
      }, false)
    })





	var products_table = $('#service_record_table').DataTable( {
		// language: {
        //     searchBuilder: {
        //         title: ``,
		// 		add: `Add Filter`
        //     }
        // },
		bSortCellsTop: true,
		// bLengthChange: true,
		scrollX: true,
		// responsive: true,
		// colReorder: true,
        dom: 'lfrtip',
		// "initComplete": function(settings, json) {
		// 	function edit_appointment(id){
		// 		fetch(`/appointment/edit-appointment/${id}`,{
		// 		method: 'POST',
		// 		body: JSON.stringify({"id" : id})
		// 	})
		// }
		// 	},
        "ajax": {
            "method" : "GET",
            "url": "/appointment/get-appointment/{{emp_id}}",
            "dataSrc": ""
        },

        "columns": [

			{ "data": "service_from"},
			{ "data": "service_to"},
			{ "data": "designation"},
			{ "data": "status"},
			{ "data": "salary"},
			{ "data": "station_place"},
			// { "data": "leave_wo_pay"},
			// { "data": "separation_date"},
			// { "data": "separation_cause"},
			{
              data: null,
			  searchable: true,
              render: function ( data, type, row ) {
                return `
				<div class="d-sm-flex flex-row">
					<a href="../${data.appointment_attachment}" title="View Attachment" id="${data.ld_attachment_file_name}" target = "_blank" >
						<i class="bi bi-box-arrow-up-right"></i> Attachment
					</a>
				</div>`;
              }
            },
            {
              data: null,
			  searchable: false,
              render: function ( data, type, row ) {
                return `
				<div class="d-sm-flex flex-row">
					<a href="/appointment/delete-appointment/${data.id}" class="btn btn-danger btn-sm m-2" title="Remove" id="${data.id}">
						<i class="bi bi-trash"></i>
					</a>
				</div>`;
              }
            }
        ]
    } );

function edit_appointment(id){

	fetch(`/appointment/edit-appointment/${id}`,{
    method: 'POST',
    body: JSON.stringify({"id" : id})
  })
	.then(response => response.json())
	.then(data => {
		console.log(data)
		var id = document.getElementById("id");
		var update_service_from = document.getElementById("update_service_from");
		var update_service_to = document.getElementById("update_service_to");
		var update_sf_present = document.getElementById("update_sf_present");
		var update_designation = document.getElementById("update_designation");
		var update_status = document.getElementById("update_status");
		var update_salary = document.getElementById("update_salary");
		var update_station_place = document.getElementById("update_station_place");
		var update_leave_wo_pay = document.getElementById("update_leave_wo_pay");
		var update_separation_date = document.getElementById("update_separation_date");
		var update_separation_cause = document.getElementById("update_separation_cause");
		var update_appointment = document.getElementById("update_appointment");

		id.value = data[0].id
		update_service_from.value = data[0].service_from
		update_service_to.value = data[0].service_to
		if(data[0].service_to == "PRESENT"){
			update_sf_present.checked = true;
			sf_present();
		}


		update_designation.value = data[0].designation
		update_status.value = data[0].status
		update_salary.value = data[0].salary
		update_station_place.value = data[0].station_place
		update_leave_wo_pay.value = data[0].leave_wo_pay
		update_separation_date.value = data[0].separation_date
		update_separation_cause.value = data[0].separation_cause
		update_appointment.value = data[0].appointment
		
  })
}

function sf_present(){
		var sf_present = document.getElementById('sf_present');
		var service_to = document.getElementById('service_to');
		var station_place = document.getElementById('station_place');
		if(sf_present.checked){
			service_to.disabled = true;
			service_to.value = ''
			// station_place.value = "NIA-PANGASINAN IMO"
			}
		else{
			service_to.disabled = false;
			}
	
	}

	function nia_pimo(){
		var nia_pimo = document.getElementById('nia_pimo');
		var station_place = document.getElementById('station_place');
		// var station_place = document.getElementById('station_place');
		if(nia_pimo.checked){
			station_place.value = "";
			station_place.disabled = true;
			}
		else{
			station_place.disabled = false;
			}
	
	}

	document.getElementById('sf_present').addEventListener('change', sf_present)
	document.getElementById('update_sf_present').addEventListener('change', sf_present)
	document.getElementById('nia_pimo').addEventListener('change', nia_pimo)

})

// function delete_file(e){
//   fetch('/employees/delete-file',{
//     method: 'POST',
//     body: JSON.stringify({"file_id" : e.id})
//   })
// 	.then(response => response.json())
// 	.then(data => {
// 		triggerToast(data);
// 		window.location.reload();
//   })
// }


// (function () {
//   'use strict'

 

// })()


	// fetch('/employees/service-record', {
    //     method: 'POST',
    //     body: formData
    //   }).then((res)=>{
    //     return res.json() 
    //   }).then(data => {
	// 	console.log(data)
	//   })
	//   .catch(console.error)


</script>
{%endblock%}