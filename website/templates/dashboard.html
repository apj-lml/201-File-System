{% extends 'base.html' %}

{% block title %} NIA PIMO {% endblock %}

{% block cssperfile %} 
    <style rel="stylesheet">
        select.birthday-select{
            border: none;
            background-color:transparent;
            font-weight: bold;
            /* font-style: italic; */
            text-align: left;
            color: rgb(51,10,113);
            color: linear-gradient(152deg, rgba(51,10,113,0.9192051820728291) 3%, rgba(0,5,121,0.8127626050420168) 37%, rgba(34,76,199,1) 98%);
            /* width: auto; */
        }

        .paragraph {
            overflow: hidden;
            max-height: 300px;
            transition: max-height 0.3s ease-out;
        }

        #read-more-btn,
        #read-less-btn {
            display: none;
            cursor: pointer;
            color: rgb(51,10,113);
            color: linear-gradient(152deg, rgba(51,10,113,0.9192051820728291) 3%, rgba(0,5,121,0.8127626050420168) 37%, rgba(34,76,199,1) 98%);
            /* width: auto; */
        }

        .removebtn {
            color:black;
              position: absolute;
              top: 0;
              right: 0;
          width:13px;
          height: 13px;
          text-align:center;
          border-radius:50%;
          font-size: 10px;
              cursor: pointer;
              background-color: #FFF
          }



          #calendar {
            width: 75%;

            max-width: 1100px;
           /* margin: 40px auto; */
          }

          @media (max-width: 576px) {
            .logo-img{
                width: 190px;
                height: 190px;
                margin-bottom: 15px;
            }

            #quote{
                font-size: 14px;
            }
        }


        
        .card {
            position: relative;
            border: none;
            border-radius: 0.5rem;
            overflow: visible; /* Allow the card-body to overflow */
        }

        .card-img-container {
            overflow: hidden; /* Ensure the image doesn't overflow the container */
        }

        .card-img-top {
            width: 100%;
            height: 400px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .card-body {
            position: absolute;
            bottom: -20px; /* Push the text container up to overlap the image */
            left: 50%;
            transform: translateX(-50%);
            background-color: white;
            width: 90%;
            height: 180px; /* Fixed height for consistency */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align items at the top */
            align-items: center;
            border-radius: 0.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            z-index: 2; /* Ensure the card-body is above other elements */
            opacity: 0.95;
            padding: 10px; /* Optional: add padding if you want space around the content */
        }

        .card-title {
            font-weight: bold;
            margin-top: 0;
            padding-top: 0;
        }

        .card-text {
            color: #6c757d;
            margin-bottom: 10px; /* Add space below text */
            line-height: 17px;
            font-size: 14px;
        }

        .card:hover .card-img-top {
            transform: scale(1.1); /* Zoom out image on hover */
        }


    </style>

{% endblock %}

{% block content %}

        <!-- Navigation-->
        <!-- <nav class="navbar navbar-light bg-light static-top">
            <div class="container">
                <a class="navbar-brand" href="#!">Start Bootstrap</a>
                <a class="btn btn-primary" href="#signup">Sign Up</a>
            </div>
        </nav> -->
		
        <!-- Masthead-->
        <div class="container-fluid vw-100 p-0 w-0">
            <header class="masthead pt-5 col-sm-12 me-0 w-100 vh-100">
                <div class="container position-relative">
                    <div class="row justify-content-center">
                        <div class="col-xl-12">
                            <div class="text-center text-white">
                                <!-- Page heading-->
                                <img src="{{url_for('static', filename='img/nia-logo.png')}}" alt="" width="250px" height="250px" class="d-inline-block align-text-center mb-md-5 logo-img">
                                                    
                                <h1 class="mb-md-5 mt-0 text-white trajan"><span style="font-size: larger;">PANGASINAN</span> <br> IRRIGATION MANAGEMENT OFFICE</h1>
                                <p class="fs-5"><i id="quote"></i></p>
                                <p class="text-center" style="font-size: large;"><b id="qauthor"></b></p>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="container py-5">
                <div class="row row-cols-1 row-cols-md-3 g-4">
                    <div class="col mb-2 animate__animated animate__fadeInUp animate__fast">
                        <div class="card h-100 shadow-sm">
                            <div class="card-img-container">
                                <img src="{{ url_for('static', filename='img/agenda.jpg') }}" class="card-img-top" alt="...">
                            </div>
                            <div class="card-body overflow-visible">
                                <h5 class="card-title my-0 py-0">7-Point Agenda</h5>
                                <!-- <p class="card-text"> -->
                                    <ul class="card-text text-start lh-2 my-0 py-0" style="margin-left: -15px;">
                                        <li>Irrigation Infrastruction Development</li>
                                        <li>Irrigators' Association Capacity Building</li>
                                        <li>Climate Smart Irrigator's Association Farming System</li>
                                        <li>Management Governance</li>
                                        <li>Monitoring & Evaluation</li>
                                        <li>Capability Building of the Human Resource</li>
                                        <li>Strategic Communication and Advocacy</li>
                                    </ul>
                                <!-- </p> -->
                            </div>
                        </div>
                    </div>

                    <div class="col mb-2 animate__animated animate__fadeInUp animate__fast">
                        <div class="card h-100 shadow-sm">
                            <div class="card-img-container">
                                <img src="{{ url_for('static', filename='img/mission.jpg') }}" class="card-img-top" alt="...">
                            </div>
                            <div class="card-body overflow-visible">
                                <h5 class="card-title my-0 py-0">Vision</h5>
                                <p class="card-text">By 2030, NIA is an advanced and innovative irrigation agency enabling highly competitive and sustainable Philippine farming communities.</p>
                            </div>
                        </div>
                    </div>

                    <div class="col mb-2  animate__animated animate__fadeInUp  animate__fast">
                        <div class="card h-100 shadow-sm">
                            <div class="card-img-container">
                                <img src="{{ url_for('static', filename='img/vision.jpg') }}" class="card-img-top" alt="...">
                            </div>
                            <div class="card-body overflow-visible">
                                <h5 class="card-title my-0 py-0">Mission</h5>
                                <p class="card-text">An efficient and well-managed government corporation developing and managing modern, resilient, and multipurpose irrigation Systems to improve agricultural productivity and increase farmers' income.</p>
                            </div>
                        </div>
                    </div>
                    <!-- Add more cards as needed -->
                </div>
            </div>
        

            <div class="col-sm-12">
                <section class="features-icons bg-light text-center pb-3 pt-4">
                    <div class="container">
                        <div class="row">
                            <div class="row">
                                <div class="col-sm-12">
                                    <h1 id="calendar-title">Perpetual Calendar</h1>
                                    {% if current_user.type_of_user == 'admin' %}
                                        <button class="btn btn-primary mb-2" onclick="printCalendar()">Print Calendar</button>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mx-auto">
                                <div class="col-md-8 col-sm-12 shadow shadow-md p-2" id="calendar_content">
                                    <div id="calendar" class="w-100 h-100 mx-auto ms-auto"></div>
                                </div>
                                <div class="col-md-4 col-sm-12">
                                    <!-- <div class="contaniner-fluid"> -->


                                    <div id="calendar2" class="w-100 h-100 mx-auto ms-auto shadow shadow-md border-0 p-2"></div>

                                        <!-- <div class="card h-100 w-100 shadow shadow-md border-0 ">
                                            <div class="card-body">
                                            <div class="row">
                                                <div class="col-sm-12">
                                                    <h4 id="eventDetailTitle" class="fw-bolder"><i class="bi bi-calendar-event"></i> Event / Activity Details</h4>
                                                </div>
                                                    <hr>

                                            </div>
                                            <div class="row overflow-auto" style="max-height: 600px;">
                                                <div class="col-sm-12 verflow-auto" id="eventDetailBody">
                                                    <h5 class="fst-italic text-muted mt-auto">Click on a date to show details</h5>
                                                </div>
                                            </div>
                                            </div>
                                        </div> -->

                                        
                                    <!-- </div> -->
                                </div>
                            </div>
                            
                            <div class="row">
                                {% if current_user.type_of_user == 'admin' %}
                                <!-- <div class="col-sm-12">
                                    <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#calendarModal">
                                        Add Event / Activity
                                      </button>
                                </div> -->
                                {% endif %}
                            </div>

                        </div>
                    </div>
                </section>
            </div>

            <hr>
            
            <!-- Icons Grid-->
            <!-- <div class="col-sm-12">
                <section class="features-icons bg-light text-center mb-5 pb-0 pt-3">
                    <div class="container">
                        <div class="row">
                            <div class="col-lg">
                                <div class="features-icons-item mx-auto mb-0 mb-lg-3">
                                    <div class="features-icons-icon d-flex"><a href="#valueFocus" class="mx-auto" id="valueFocusBtn"><i class="bi bi-heart-fill m-auto text-blue"></i></a></div>
                                    <h4>Value Focus</h4>
                                    <p class="lead mb-0">Weekly value focus - anytime, anywhere.</p>
                                </div>
                            </div>
                            <div class="col-lg">
                                <div class="features-icons-item mx-auto mb-0 mb-lg-3">
                                    <div class="features-icons-icon d-flex"><a href="#valueFocus" class="mx-auto" id="valueFocusBtn"><i class="bi bi-7-circle-fill text-blue"></i></a></div>
                                    <h4>7-Point Agenda</h4>
                                    <p class="lead mb-0">Look at the Administrator's 7-Point Strategic Policy Agenda.</p>
                                </div>
                            </div>
                            <div class="col-lg">
                                <div class="features-icons-item mx-auto mb-0 mb-lg-3">
                                    <div class="features-icons-icon d-flex"><a href="#valueFocus" class="mx-auto" id="valueFocusBtn"><i class="bi bi-flag text-blue"></i></a></div>
                                    <h4>Quality Policy</h4>
                                    <p class="lead mb-0">NIA's Quality Policy.</p>
                                </div>
                            </div>
                            <div class="col-lg">
                                <div class="features-icons-item mx-auto mb-0 mb-lg-3">
                                    <div class="features-icons-icon d-flex"><a href="#mission" class="mx-auto"><i class="bi bi-graph-up-arrow m-auto text-blue"></i></a></div>
                                    <h4>Mission & Vision</h4>
                                    <p class="lead mb-0">Look at NIA's Mission & Vision.</p>
                                </div>
                            </div>
                            <div class="col-lg">
                                <div class="features-icons-item mx-auto mb-0 mb-lg-3">
                                    <div class="features-icons-icon d-flex"><a href="#birthdays" class="mx-auto"><i class="bi bi-cake text-blue"></i></a></div>
                                    <h4>Birthdays</h4>
                                    <p class="lead mb-0">See whose birthday today and greet them!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>  -->


        

            <section class="showcase">
                <div class="container-fluid p-0">
                    <div class="row g-0"  id="valueFocus">
                        <div class="col-lg-6 order-lg-2 text-white showcase-img text-center">
                            <img class="img-fluid" src="https://www.crfv-cpu.org{{ blog_image['src'] }}"/>
                            <!-- <img class="img-fluid" src="https://www.crfv-cpu.org{{ blog_image['src'] }}" width="450px;" height="450px;"/> -->
                        </div>
                        <div class="col-lg-6 order-lg-1 my-auto showcase-text">
                            <h2>{{ blog_title[0] | safe }}</h2>
                            {{ blog_paragraph | safe}}
                            <div class="lead mb-0" id="blog-content"></div>
                            <span id="dots">
                                <p id="read-more-btn" onclick="toggleReadMore()">...Read More</p>
                                <p id="read-less-btn" onclick="toggleReadMore()">Read Less...</p>
                            </span>

                        </div>

                    </div>
                    <!-- <div class="row g-0" id="mission">
                            <div class="col-lg-6 text-white showcase-img">
                            <img class="img-fluid" src="{{ url_for('static', filename='img/mission.jpg') }}" loading="lazy" alt="mission" />
                        </div>
                        <div class="col-lg-6 my-auto showcase-text">
                            <h2>Mission</h2>
                            <p class="lead mb-0">An efficient and well-managed government corporation developing and managing modern, resilient, and multipurpose irrigation Systems to improve agricultural productivity and increase farmers' income.</p>
                            <br>
                            <h2>Vision</h2>
                            <p class="lead mb-0">By 2030, NIA is an advanced and innovative irrigation agency enabling highly competitive and sustainable Philippine farming communities.</p>
                        </div>
                    </div> -->
                    <!-- <div class="row g-0" id="vision">
                        <div class="col-lg-6 order-lg-2 text-white showcase-img">
                            <img class="img-fluid" src="{{ url_for('static', filename='img/vision.png') }}" loading="lazy" alt="vision"/>
                        </div>
                        <div class="col-lg-6 order-lg-1 my-auto showcase-text">
                            <h2>Quality Policy</h2>
                            <p class="lead mb-0">
                                We commit to provide efficient, effective, and sustainable irrigation services aimed towards the highest satisfaction of the Filipino farmers.
                                <br>
                                <br>
                                We strive for the attainment of our strategic themes of Technical and Operational Excellence, and Good Governance through Partnership with the farmers and other relevant interested parties.
                                <br>
                                <br>

                                We commit to establish programs that prevent work-related injury and ill health, and encourage participation and consultation workers within Agency.

                                <br>
                                <br>

                                We abide with applicable legal and international requirements and we remain dedicated to the core values of Commitment, Integrity and Professionalism, to continually improve the NIAâ€™s Integrated Management System.
                            </p>
                        </div>
                    </div> -->
                    <!-- <div class="row g-0" id="mission">
                        <div class="col-lg-6 text-white showcase-img">
                            <img class="img-fluid" src="{{ url_for('static', filename='img/agenda.png') }}" loading="lazy" alt="mission" />
                        </div>
                        <div class="col-lg-6 my-auto showcase-text">
                            <h2>7-Point Strategic Policy Agenda</h2>
                            <ul class="fs-4">
                                <li>Irrigation Infrastruction Development</li>
                                <li>Irrigators' Association Capacity Building</li>
                                <li>Climate Smart Irrigator's Association Farming System</li>
                                <li>Management Governance</li>
                                <li>Monitoring & Evaluation</li>
                                <li>Capability Building of the Human Resource</li>
                                <li>Strategic Communication and Advocacy</li>
                            </ul>
                        </div>
                    </div> -->
                    <div class="row g-0" id="vision">
                        <div class="col-lg-6 order-lg-1 text-white showcase-img">
                            <div id="carouselExampleControls" class="carousel carousel-dark slide carousel-fade" data-bs-ride="carousel" >
                                <div class="carousel-inner">
                                    {% for celebs in bday_celebs %}
                                    <div class="carousel-item {{ 'active' if loop.index == 1 }}" id="">
                                      <img src="{{ url_for('static', filename='img/birthday/' + today_date.strftime('%m') + '/'+ celebs.id|string +'.png') }}" class="d-block w-100 h-90" alt="birthdays">
                                    </div>
                                  {% endfor %}
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                  <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                  <span class="visually-hidden">Next</span>
                                </button>
                              </div>
                        </div>
                        <div class="col-lg-6 order-lg-2 my-auto showcase-text" id="birthdays">
                            <h2 class="mt-3">Birthday Celebrators</h2>
                            <h4>
                                Month of 
                                 <select name="" id="birthday-select" value="{{ today_date.strftime('%m') }}" class="birthday-select">
                                     <option value="{{ today_date.strftime('%m') }}" selected hidden>{{ today_date.strftime('%B') }}</option>
                                     <option value="01">January</option>
                                     <option value="02">February</option>
                                     <option value="03">March</option>
                                     <option value="04">April</option>
                                     <option value="05">May</option>
                                     <option value="06">June</option>
                                     <option value="07">July</option>
                                     <option value="08">August</option>
                                     <option value="09">September</option>
                                     <option value="10">October</option>
                                     <option value="11">November</option>
                                     <option value="12">December</option>
                                 </select>
                            </h4>
                             <ul id="listOfBirthdayCelebrators">
                                 {% for celebs in bday_celebs %}
                                     <li>{{celebs.birthdate.strftime('%d')}} &#8212; {{celebs.last_name}}, {{celebs.first_name}} {{ "" if celebs.name_extn is none or celebs.name_extn == "" or celebs.name_extn == "N/A" else celebs.name_extn }} {{ celebs.middle_name if celebs.middle_name is none or celebs.middle_name == "" or celebs.middle_name == "N/A" else celebs.middle_name }}</li>
                                 {% endfor %}
                             </ul>
           
                        </div>
                    </div>
                </div>
            </section>

        <!-- Call to Action-->
        <section class="call-to-action text-white text-center col-sm-12">
            <div class="container position-relative">
                <div class="row justify-content-center">
                    <div class="col-xl-6">
                        <img src="{{url_for('static', filename='img/nia-logo.png')}}" alt="" width="150px" height="150px" class="d-inline-block align-text-center mb-md-2">
                        <h2 class="mb-md-4 trajan text-white">PANGASINAN <br> IRRIGATION MANAGEMENT OFFICE</h2>
                        
                    </div>
                </div>
            </div>
        </section>
        <!-- Footer-->



        </div>
     

        <!-- Modal -->



<!-- Button trigger modal -->
<!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#calendarModal">
    Launch demo modal
  </button>
   -->
  <!-- Modal -->
  <div class="modal fade" id="calendarModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel"><i class="bi bi-calendar2-plus-fill"></i> Create Event / Activity </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="closeModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="container">
                <form action="#" method="POST" id="add_event_form">
             
                <div class="row">
                    <div class="form-floating p-1 col-md-6 col-sm-12 p-1">
                        <select class="form-select" id="e_type" name="e_type">
                            <option value="DEADLINE">DEADLINE</option>
                            <option value="SPECIAL HOLIDAY">SPECIAL HOLIDAY</option>
                            <option value="REGULAR HOLIDAY">REGULAR HOLIDAY</option>
                            <option value="MEETING">MEETING</option>
                            <option value="OTHERS">OTHERS</option>
                            <option value="TRAINING" selected>TRAINING/SEMINAR</option>
                            <option value="WORK SUSPENSION">WORK SUSPENSION</option>
                          </select>
                        <label for="e_type">Event/Activity Type</label>
                    </div>
                    <div class="form-floating col-md-6 col-sm-12 p-1">
                        <select class="form-select" id="e_repeat" name="e_repeat" value="" form="add_event_form">
                        <option value="" selected>Doesn't Repeat</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Annually</option>
                        </select>
                        <label for="repeat">Does this event / activity repeat?</label>
                    </div>
                </div>
                <div class="row">
                    <div class="form-floating col-md-12 col-sm-12 p-1">
                        <textarea  style="height: 100px" class="form-control" id="e_title" name ="e_title" form="add_event_form" placeholder="Event / Activity Title" value="" required></textarea>
                        <label for="e_title">Event/Activity Title<span class="is-required">*</span></label>
                    </div>
                    <div class="form-floating col-md-12 col-sm-12 p-1">
                        <input type="text" class="form-control" id="e_venue" name ="e_venue" form="add_event_form" placeholder="Event / Activity Venue" value="" required>
                        <label for="e_venue">Event/Activity Venue<span class="is-required">*</span></label>
                    </div>
                </div>
                <div class="row">
                    <div class="form-floating col-md-12 col-sm-12 p-1">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="e_all_day" name="e_all_day" onchange="validateDate()" unchecked>
                            <label class="form-check-label" for="e_all_day">8:00 AM to 5:00 PM</label>
                        </div>
                    </div>
                </div>
                <div class="row" id="dateOnly">
                    <div class="form-floating col-md-6 col-sm-12 p-1">
                        <input type="datetime-local" class="form-control" id="e_date_from" name ="e_date_from" form="add_event_form" placeholder="e_date_from" onchange="validateDate()" required>
                        <label for="e_date_from">Event Date (From)<span class="is-required">*</span></label>
                    </div>
                    <div class="form-floating col-md-6 col-sm-12 p-1">
                        <input type="datetime-local" class="form-control" id="e_date_to" name ="e_date_to" form="add_event_form" placeholder="e_date_to" onchange="validateDate()" required>
                        <label for="e_date_to">Event Date (To)<span class="is-required">*</span></label>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-sm-12">
                        <p class="text-muted p-0 m-0">
                            *Please take note that you can not repeat events with multipe dates.
                        </p>
                    </div>
                </div>
                <div class="row">
                    <div class="form-floating col-md-12 col-sm-12 p-1">
                        <textarea type="text" class="form-control" id="e_description" name ="e_description" form="add_event_form" placeholder="Remarks / Reference" style="height: 100px"></textarea>
                        <label for="e_description">Remarks / Reference</label>
                    </div>
                </div>
            </div>
        </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal()">Close</button>
          <button type="submit" class="btn btn-primary" form="add_event_form">Save Event / Activity</button>
        </div>
      </div>
    </div>
  </div>

    <!-- Modal -->
    <div class="modal fade" id="EditCalendarModal" tabindex="-1" aria-labelledby="EditCalendarModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="EditCalendarModalLabel"><i class="bi bi-calendar2-week-fill"></i> Edit Event / Activity </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="closeModal()" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <form action="#" method="POST" id="update_event_form">
                        <input type="hidden" id="e_id" name="e_id">
                    <div class="row">
                        <div class="form-floating p-1 col-md-6 col-sm-12 p-1">
                            <select class="form-select" id="update_e_type" name="e_type">
                                <option value="DEADLINE">DEADLINE</option>
                                <option value="SPECIAL HOLIDAY">SPECIAL HOLIDAY</option>
                                <option value="REGULAR HOLIDAY">REGULAR HOLIDAY</option>
                                <option value="MEETING">MEETING</option>
                                <option value="OTHERS">OTHERS</option>
                                <option value="TRAINING" selected>TRAINING/SEMINAR</option>
                                <option value="WORK SUSPENSION">WORK SUSPENSION</option>
                              </select>
                            <label for="e_type">Event/Activity Type</label>
                        </div>
                        <div class="form-floating col-md-6 col-sm-12 p-1">
                            <select class="form-select" id="update_e_repeat" name="e_repeat" value="" form="update_event_form">
                            <option value="" selected>Doesn't Repeat</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="yearly">Annually</option>
                            </select>
                            <label for="repeat">Does this event / activity repeat?</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-floating col-md-12 col-sm-12 p-1">
                            <textarea  style="height: 100px" class="form-control" id="update_e_title" name ="e_title" form="update_event_form" placeholder="Event / Activity Title" value="" required></textarea>
                            <label for="e_title">Event/Activity Title<span class="is-required">*</span></label>
                        </div>
                        <div class="form-floating col-md-12 col-sm-12 p-1">
                            <input type="text" class="form-control" id="update_e_venue" name ="e_venue" form="update_event_form" placeholder="Event / Activity Venue" value="" required>
                            <label for="e_venue">Event/Activity Venue<span class="is-required">*</span></label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-floating col-md-12 col-sm-12 p-1">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="update_e_all_day" name="e_all_day" onchange="validateDateUpdateForm()" unchecked>
                                <label class="form-check-label" for="e_all_day">8:00 AM to 5:00 PM</label>
                            </div>
                        </div>
                    </div>
                    <div class="row" id="dateOnly">
                        <div class="form-floating col-md-6 col-sm-12 p-1">
                            <input type="datetime-local" class="form-control" id="update_e_date_from" name ="e_date_from" form="update_event_form" placeholder="e_date_from" onchange="validateDateUpdateForm()" required>
                            <label for="e_date_from">Event Date (From)<span class="is-required">*</span></label>
                        </div>
                        <div class="form-floating col-md-6 col-sm-12 p-1">
                            <input type="datetime-local" class="form-control" id="update_e_date_to" name ="e_date_to" form="update_event_form" placeholder="e_date_to" onchange="validateDateUpdateForm()" required>
                            <label for="e_date_to">Event Date (To)<span class="is-required">*</span></label>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-sm-12">
                            <p class="text-muted p-0 m-0">
                                *Please take note that you can not repeat events with multipe dates.
                            </p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-floating col-md-12 col-sm-12 p-1">
                            <textarea type="text" class="form-control" id="update_e_description" name ="e_description" form="update_event_form" placeholder="Remarks / Reference" style="height: 100px"></textarea>
                            <label for="e_description">Remarks / Reference</label>
                        </div>
                    </div>
                </div>
            </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="closeModal()">Close</button>
              <button type="submit" class="btn btn-primary" form="update_event_form">Save Event / Activity</button>
            </div>
          </div>
        </div>
      </div>

		{% endblock %}

        {% block scripts %}

        <!-- <script src='https://cdn.jsdelivr.net/npm/fullcalendar/core/locales/es.global.js'></script> -->
        
        <script type="application/javascript">

            // self executing function here
      //      (function() {
                var prevClickedDayEl = null;
                var myModal = new bootstrap.Modal(document.getElementById('calendarModal'), {
                    //keyboard: false
                    });
                var myModalEdit = new bootstrap.Modal(document.getElementById('EditCalendarModal'));

                var calendarEl = document.getElementById('calendar');
                var calendarEl2 = document.getElementById('calendar2');


                var calendar = new FullCalendar.Calendar(calendarEl, {
                    allDayText:'8:00am-5:00pm',
                    themeSystem: 'bootstrap5',
                    initialView: mobilecheck() ? "dayGridWeek" : "dayGridMonth",
                    views: {
                        fourMonth: {
                          type: 'multiMonth',
                          duration: { months: 4 },
                          buttonText: 'Multi Month'
                        }
                      },
                    dayMaxEvents: true,
                    headerToolbar: {
                        left: 'title',
                        center: '{% if current_user.type_of_user == 'admin' %}addEventButton{% endif %}',
                        right: mobilecheck() ? 'prev,next today dayGridWeek,listYear' : 'prev,next today dayGridMonth,listMonth,fourMonth'
                      },

                    //selectable: true,
                    editable: {% if current_user.type_of_user == 'admin' %} true {% else %} false {% endif %},
                    droppable: {% if current_user.type_of_user == 'admin' %} true {% else %} false {% endif %},
                    
                    displayEventTime: true,
                    customButtons: {
                        addEventButton: {
                          text: mobilecheck() ? 'Add' : 'Add Event / Activity',
                          click: function() {
                            myModal.show();
                          }
                        }, 
                      },

                    eventDrop: function(info){
                    updateEvent(info);
                    },

                    eventResize: function(info) {
                    updateEvent(info);
                    },

                    eventClick: function(info){

                        //if (confirm('Are you sure you want to remove this event?')) {
                        //    calendar.getEventById(info.event.id).remove();
                        //  }
                        let e_id = document.getElementById('e_id');
                        let update_e_type = document.getElementById('update_e_type');
                        let update_e_repeat = document.getElementById('update_e_repeat');
                        let update_e_title = document.getElementById('update_e_title');
                        let update_e_venue = document.getElementById('update_e_venue');
                        let update_e_all_day =  document.getElementById('update_e_all_day');
                        let update_e_date_from = document.getElementById('update_e_date_from');
                        let update_e_date_to = document.getElementById('update_e_date_to');
                        let update_e_description = document.getElementById('update_e_description');

                        console.log('event click ==========>', info.event.extendedProps.e_type);
                        
                        e_id.value = info.event.id;
                        update_e_type.value = info.event.extendedProps.e_type;
                        update_e_repeat.value = info.event.extendedProps.repeat;
                        update_e_title.value = info.event.title;
                        update_e_venue.value = info.event.extendedProps.venue;
                        update_e_all_day.checked = info.event.allDay;


                        var startDate = new Date(info.event.start);
                        var endDate = new Date(info.event.end);


                        if (startDate.toDateString() !== endDate.toDateString()) {
                            endDate.setDate(endDate.getDate() - 1);
                        }

                        if(info.event.allDay){
                            update_e_date_from.type = 'date';
                            update_e_date_to.type = 'date';

                        var formattedStartDate = startDate.getFullYear() + '-' +
                            ('0' + (startDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + startDate.getDate()).slice(-2);

                        var formattedEndDate = endDate.getFullYear() + '-' +
                            ('0' + (endDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + endDate.getDate()).slice(-2);

                        }else{

                            update_e_date_from.type = 'datetime-local';
                            update_e_date_to.type = 'datetime-local';

                            var formattedStartDate = startDate.getFullYear() + '-' +
                            ('0' + (startDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + startDate.getDate()).slice(-2) + ' ' +
                            ('0' + startDate.getHours()).slice(-2) + ':' +
                            ('0' + startDate.getMinutes()).slice(-2) + ':' +
                            ('0' + startDate.getSeconds()).slice(-2);

                            var formattedEndDate = endDate.getFullYear() + '-' +
                            ('0' + (endDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + endDate.getDate()).slice(-2) + ' ' +
                            ('0' + endDate.getHours()).slice(-2) + ':' +
                            ('0' + endDate.getMinutes()).slice(-2) + ':' +
                            ('0' + endDate.getSeconds()).slice(-2);
                        }


                        update_e_date_from.value = formattedStartDate;
                        update_e_date_to.value = formattedEndDate;
                        update_e_description.value = info.event.extendedProps.description;

                        {% if current_user.type_of_user == 'admin' %}
                            myModalEdit.show();
                        {% endif %}
                    },
                    
                    eventRemove: function(info) {
                        fetch(`/calendar/remove-event`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'}, 
                            body: JSON.stringify({
                                "id": info.event.id
                            })
                        }).then((res) => {
                            if (res.status == 200) {
                                return res.json();
                            }
                        });
                    },

                    dateClick: function(info) {

                        if (prevClickedDayEl) {
                            prevClickedDayEl.style.backgroundColor = '';
                        }
            
                        // Check if the clicked day is the same as the previously clicked day
                        var isSameDay = prevClickedDayEl === info.dayEl;

                        // Reset background color of previously clicked day if it's not the same day
                        if (prevClickedDayEl && !isSameDay) {
                            prevClickedDayEl.style.backgroundColor = '';
                        }

                        // Toggle background color of currently clicked day
                        if (!isSameDay || !prevClickedDayEl) {
                            info.dayEl.style.backgroundColor = '#ebfffb';
                        } else {
                            info.dayEl.style.backgroundColor = '';
                        }

                        // Update prevClickedDayEl to current day
                        prevClickedDayEl = info.dayEl;


                        var clickedDate = new Date(info.dateStr);

                        var eventsForDate = [];
                        

                        calendar.getEvents().forEach(function(event) {
                            var startDate = new Date(event.start);
                            var endDate = new Date(event.end);

                            if (new Date(event.start).toLocaleDateString('en-US') !== new Date(event.end).toLocaleDateString('en-US')) {
                                endDate.setDate(endDate.getDate() - 1);
                            }

                            if (new Date(clickedDate).toLocaleDateString('en-US') >= new Date(event.start).toLocaleDateString('en-US') && new Date(clickedDate).toLocaleDateString('en-US') <= endDate.toLocaleDateString('en-US')) {
                                eventsForDate.push(event);
                            }

                        });

                        var date = new Date(clickedDate);

                        var options = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
                        var formattedTitleDate = date.toLocaleDateString('en-US', options);

                        let elEventDetailTitle = document.getElementById('eventDetailTitle');
                        let eventDetailBody = document.getElementById('eventDetailBody');

                        elEventDetailTitle.innerHTML = formattedTitleDate

                        let html = '';

                        if(eventsForDate.length > 0){

                        eventsForDate.forEach(function(event) {
                            let formattedDateRange = "";
                            let formattedTimeRange = "";

                            var startDate = new Date(event.start);
                            var endDate = new Date(event.end);


                                                        
                            if (startDate.toLocaleDateString('en-US') !== endDate.toLocaleDateString('en-US')) {
                                endDate.setDate(endDate.getDate() - 1);
                            }

                            var formattedStartDate = startDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
                            var formattedEndDate = endDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });


                            var formattedStartTime = formatTimeWithAmPm(startDate);
                            var formattedEndTime = formatTimeWithAmPm(endDate);

                            
                            if(formattedStartDate == formattedEndDate){
                                formattedDateRange = formattedStartDate;
                                formattedTimeRange = formattedStartTime + ' to ' + formattedEndTime;
                                //formattedTimeRange = formattedStartTime;
                            }else{
                                formattedDateRange = formattedStartDate + ' to ' + formattedEndDate;
                                formattedTimeRange = formattedStartTime + ' to ' + formattedEndTime;
                            } 
                            
                            if(event.allDay){
                                formattedTimeRange = "N/A";
                            }

                            html += `
                                <div class="card mb-3" id="cardId_${event.id}">
                                    <div class="card-header">
                                        <h6 class="card-title">${event.title}</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text text-start">
                                            <b>DATE : </b>${ formattedDateRange } <br>
                                            <b>TIME : </b>${ formattedTimeRange } <br>
                                            <b>VENUE : </b>${ event.extendedProps.venue }
                                        </p>
                                        <p class="card-text text-start">
                                            ${ event.extendedProps.description }
                                        </p>
                                {% if current_user.type_of_user == 'admin' %}
                                    <button type="button" class="btn btn-danger btn-sm" onclick="removeEvent(${event.id})"><i class="bi bi-calendar-x-fill"></i> Delete Event / Activity</a>
                                {% endif %}
                                    </div>
                                </div>
                                `;
                            
                        });
                    }else{
                        html += `
                            <h5 class="fst-italic text-muted mt-auto">No Event / Activity set to this date.</h5>
                        `;

                    }
                        eventDetailBody.innerHTML = html
                        
                      },


                });


                var calendar2 = new FullCalendar.Calendar(calendarEl2, {
                    allDayText:'8:00am-5:00pm',
                    themeSystem: 'bootstrap5',
                    views: {
                        listMonth: {
                          type: 'listMonth',
                          buttonText: 'Month'
                        },
                        listYear: {
                            type: 'listYear',
                            buttonText: 'Year'
                        },
                        
                      },
                    initialView: 'listMonth',
                    dayMaxEvents: true,
                    headerToolbar: {
                        left: 'title',
                        center: '',
                        right:'prev,next listYear,listMonth'
                      },

                    //selectable: true,
                    editable: false,
                    displayEventTime: true,

                    eventResize: function(info) {
                    updateEvent(info);
                    },

                    eventClick: function(info){

                        //if (confirm('Are you sure you want to remove this event?')) {
                        //    calendar.getEventById(info.event.id).remove();
                        //  }
                        let e_id = document.getElementById('e_id');
                        let update_e_type = document.getElementById('update_e_type');
                        let update_e_repeat = document.getElementById('update_e_repeat');
                        let update_e_title = document.getElementById('update_e_title');
                        let update_e_venue = document.getElementById('update_e_venue');
                        let update_e_all_day =  document.getElementById('update_e_all_day');
                        let update_e_date_from = document.getElementById('update_e_date_from');
                        let update_e_date_to = document.getElementById('update_e_date_to');
                        let update_e_description = document.getElementById('update_e_description');

                        
                        e_id.value = info.event.id;
                        update_e_type.value = info.event.extendedProps.e_type;
                        update_e_repeat.value = info.event.extendedProps.repeat;
                        update_e_title.value = info.event.title;
                        update_e_venue.value = info.event.extendedProps.venue;
                        update_e_all_day.checked = info.event.allDay;


                        var startDate = new Date(info.event.start);
                        var endDate = new Date(info.event.end);


                        if (startDate.toDateString() !== endDate.toDateString()) {
                            endDate.setDate(endDate.getDate() - 1);
                        }

                        if(info.event.allDay){
                            update_e_date_from.type = 'date';
                            update_e_date_to.type = 'date';

                        var formattedStartDate = startDate.getFullYear() + '-' +
                            ('0' + (startDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + startDate.getDate()).slice(-2);

                        var formattedEndDate = endDate.getFullYear() + '-' +
                            ('0' + (endDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + endDate.getDate()).slice(-2);

                        }else{

                            update_e_date_from.type = 'datetime-local';
                            update_e_date_to.type = 'datetime-local';

                            var formattedStartDate = startDate.getFullYear() + '-' +
                            ('0' + (startDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + startDate.getDate()).slice(-2) + ' ' +
                            ('0' + startDate.getHours()).slice(-2) + ':' +
                            ('0' + startDate.getMinutes()).slice(-2) + ':' +
                            ('0' + startDate.getSeconds()).slice(-2);

                            var formattedEndDate = endDate.getFullYear() + '-' +
                            ('0' + (endDate.getMonth() + 1)).slice(-2) + '-' +
                            ('0' + endDate.getDate()).slice(-2) + ' ' +
                            ('0' + endDate.getHours()).slice(-2) + ':' +
                            ('0' + endDate.getMinutes()).slice(-2) + ':' +
                            ('0' + endDate.getSeconds()).slice(-2);
                        }


                        update_e_date_from.value = formattedStartDate;
                        update_e_date_to.value = formattedEndDate;
                        update_e_description.value = info.event.extendedProps.description;

                        {% if current_user.type_of_user == 'admin' %}
                            myModalEdit.show();
                        {% endif %}
                    },
                    
                    eventRemove: function(info) {
                        fetch(`/calendar/remove-event`, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'}, 
                            body: JSON.stringify({
                                "id": info.event.id
                            })
                        }).then((res) => {
                            if (res.status == 200) {
                                return res.json();
                            }
                        });
                    },

                    dateClick: function(info) {

                        if (prevClickedDayEl) {
                            prevClickedDayEl.style.backgroundColor = '';
                        }
            
                        // Check if the clicked day is the same as the previously clicked day
                        var isSameDay = prevClickedDayEl === info.dayEl;

                        // Reset background color of previously clicked day if it's not the same day
                        if (prevClickedDayEl && !isSameDay) {
                            prevClickedDayEl.style.backgroundColor = '';
                        }

                        // Toggle background color of currently clicked day
                        if (!isSameDay || !prevClickedDayEl) {
                            info.dayEl.style.backgroundColor = '#ebfffb';
                        } else {
                            info.dayEl.style.backgroundColor = '';
                        }

                        // Update prevClickedDayEl to current day
                        prevClickedDayEl = info.dayEl;


                        var clickedDate = new Date(info.dateStr);

                        var eventsForDate = [];
                        

                        calendar.getEvents().forEach(function(event) {
                            var startDate = new Date(event.start);
                            var endDate = new Date(event.end);

                            if (new Date(event.start).toLocaleDateString('en-US') !== new Date(event.end).toLocaleDateString('en-US')) {
                                endDate.setDate(endDate.getDate() - 1);
                            }

                            if (new Date(clickedDate).toLocaleDateString('en-US') >= new Date(event.start).toLocaleDateString('en-US') && new Date(clickedDate).toLocaleDateString('en-US') <= endDate.toLocaleDateString('en-US')) {
                                eventsForDate.push(event);
                            }

                        });

                        var date = new Date(clickedDate);

                        var options = { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' };
                        var formattedTitleDate = date.toLocaleDateString('en-US', options);

                        let elEventDetailTitle = document.getElementById('eventDetailTitle');
                        let eventDetailBody = document.getElementById('eventDetailBody');

                        elEventDetailTitle.innerHTML = formattedTitleDate

                        let html = '';

                        if(eventsForDate.length > 0){

                        eventsForDate.forEach(function(event) {
                            let formattedDateRange = "";
                            let formattedTimeRange = "";

                            var startDate = new Date(event.start);
                            var endDate = new Date(event.end);


                                                        
                            if (startDate.toLocaleDateString('en-US') !== endDate.toLocaleDateString('en-US')) {
                                endDate.setDate(endDate.getDate() - 1);
                            }

                            var formattedStartDate = startDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });
                            var formattedEndDate = endDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric', year: 'numeric' });


                            var formattedStartTime = formatTimeWithAmPm(startDate);
                            var formattedEndTime = formatTimeWithAmPm(endDate);

                            
                            if(formattedStartDate == formattedEndDate){
                                formattedDateRange = formattedStartDate;
                                formattedTimeRange = formattedStartTime + ' to ' + formattedEndTime;
                                //formattedTimeRange = formattedStartTime;
                            }else{
                                formattedDateRange = formattedStartDate + ' to ' + formattedEndDate;
                                formattedTimeRange = formattedStartTime + ' to ' + formattedEndTime;
                            } 
                            
                            if(event.allDay){
                                formattedTimeRange = "N/A";
                            }

                            html += `
                                <div class="card mb-3" id="cardId_${event.id}">
                                    <div class="card-header">
                                        <h6 class="card-title">${event.title}</h6>
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text text-start">
                                            <b>DATE : </b>${ formattedDateRange } <br>
                                            <b>TIME : </b>${ formattedTimeRange } <br>
                                            <b>VENUE : </b>${ event.extendedProps.venue }
                                        </p>
                                        <p class="card-text text-start">
                                            ${ event.extendedProps.description }
                                        </p>
                                {% if current_user.type_of_user == 'admin' %}
                                    <button type="button" class="btn btn-danger btn-sm" onclick="removeEvent(${event.id})"><i class="bi bi-calendar-x-fill"></i> Delete Event / Activity</a>
                                {% endif %}
                                    </div>
                                </div>
                                `;
                            
                        });
                    }else{
                        html += `
                            <h5 class="fst-italic text-muted mt-auto">No Event / Activity set to this date.</h5>
                        `;

                    }
                        eventDetailBody.innerHTML = html
                        
                      },


                });








                calendar.render();
                calendar2.render();

                fetchCalendarEvents(calendar);
                fetchCalendarEvents(calendar2);


                 window.closeModal = function() {
                    myModal.hide();
                    myModalEdit.hide();

                    let add_event_form = document.getElementById('add_event_form');
                    let update_event_form = document.getElementById('update_event_form');
                    add_event_form.reset();
                    update_event_form.reset();


                };

                document.getElementById('e_all_day').addEventListener('change', (e)=>{
                    if(e.target.checked){
                        document.getElementById('e_date_from').type = 'date';
                        document.getElementById('e_date_to').type = 'date';
                    }else{
                        document.getElementById('e_date_from').type = 'datetime-local';
                        document.getElementById('e_date_to').type = 'datetime-local';
                    }
                });

                document.getElementById('update_e_all_day').addEventListener('change', (e)=>{
                    if(e.target.checked){
                        document.getElementById('update_e_date_from').type = 'date';
                        document.getElementById('update_e_date_to').type = 'date';
                    }else{
                        document.getElementById('update_e_date_from').type = 'datetime-local';
                        document.getElementById('update_e_date_to').type = 'datetime-local';
                    }
                });


                document.getElementById('add_event_form').addEventListener('submit',(e)=>{
                    e.preventDefault();

                    var e_title = document.getElementById('e_title');
                    var e_all_day = document.getElementById('e_all_day');
                    var dateStrt = document.getElementsByName('e_date_from');
                    var dateEnd = document.getElementsByName('e_date_to');
                    
                    let allDay = false;
                    if(e_all_day.checked){
                        allDay = true;
                    }

                    let add_event_form = document.getElementById('add_event_form');
                
                    // Submit form data using FormData
                    let formData2 = new FormData(add_event_form);
            
                    const data2 = {};
                    formData2.forEach((value, key) => (data2[key] = value));
            
                    fetch(`/calendar/add-event`, {
                        method: 'POST',
                        body: formData2
                    }).then((res) => {
                        if (res.status == 200) {
                            return res.json();
                        }
                    }).then((data)=>{
                        Object.entries(data).forEach(([key, value]) => {
                 
                            //console.log('======>added value', value);

                            if(value.allDay){
                                value.end = new Date(value.end).setDate(new Date(value.end).getDate() + 1);
                            }
                            //console.log(value.end);

                            calendar.addEvent(value);
                        });
                        closeModal();

                    });
                  });

                  document.getElementById('update_event_form').addEventListener('submit',(e)=>{
                    e.preventDefault();

                    var e_id = document.getElementById('e_id');
                    
                    let allDay = false;
                    if(e_all_day.checked){
                        allDay = true;
                    }

                    let add_event_form = document.getElementById('update_event_form');
                
                    // Submit form data using FormData
                    let formData2 = new FormData(add_event_form);
            
                    const data2 = {};
                    formData2.forEach((value, key) => (data2[key] = value));
            
                    fetch(`/calendar/update-event-all`, {
                        method: 'POST',
                        body: formData2
                    }).then((res) => {
                        if (res.status == 200) {
                            return res.json();
                        }
                    }).then((data)=>{
                        var updatedEvent = calendar.getEventById(e_id.value);
                        if (updatedEvent) {
                            //updatedEvent.setProp('title', data.title);
                            // Update other event properties as needed
                        }

                        Object.entries(data).forEach(([key, value]) => {

                            var e_type = value.e_type;
                            if(value.e_type == '' || value.e_type == null){
                                e_type = '';
                            }
                            updatedEvent.setProp('title', value.title);
                            updatedEvent.setStart(value.start);
                            updatedEvent.setEnd(value.end);
                            updatedEvent.setAllDay(value.allDay);
                            updatedEvent.setProp('color', value.color);
                            updatedEvent.setProp('textColor', value.textColor);
                            updatedEvent.setProp('display', value.display);
                            updatedEvent.setExtendedProp('rrule', value.rrule);
                            updatedEvent.setExtendedProp('venue', value.venue);
                            updatedEvent.setExtendedProp('e_type', e_type);
                            updatedEvent.setExtendedProp('repeat', value.repeat);
                            updatedEvent.setExtendedProp('description', value.description);

                        });

                        //calendar.render();
                        closeModal();

                    });
                  });

                  function printCalendar() {
                    var currentView = calendar.view;
                    var currentStart = currentView.currentStart;
                
                    var currentMonth = currentStart.getMonth();
                    var currentYear = currentStart.getFullYear();
                    var monthName = new Date(currentYear, currentMonth).toLocaleDateString('en-US', { month: 'long' });
                
                    var events = calendar.getEvents();
                    events.sort((a, b) => new Date(a.start) - new Date(b.start));
                
                    function generateDaysOfMonth(year, month) {
                        var date = new Date(year, month, 1);
                        var days = [];
                        while (date.getMonth() === month) {
                            days.push(new Date(date));
                            date.setDate(date.getDate() + 1);
                        }
                        return days;
                    }
                
                    var days = generateDaysOfMonth(currentYear, currentMonth);
                    var firstDayIndex = new Date(currentYear, currentMonth, 1).getDay();
                
                    function formatTime(date) {
                        return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: 'numeric', hour12: true });
                    }
                
                    function isRecurringEvent(event) {
                        return event.extendedProps && event.extendedProps.rrule;
                    }
                
                    function generateEventList(date, events) {
                        var eventList = '<ul style="padding-left: 15px; margin: 0;">';
                
                        events.forEach(event => {
                            if (isRecurringEvent(event)) {
                                var rrule = new RRule(event.extendedProps.rrule);
                                if (rrule && rrule.between(date, date).length > 0) {
                                    eventList += formatEvent(event);
                                }
                            } else {
                                if (date.toDateString() === new Date(event.start).toDateString()) {
                                    eventList += formatEvent(event);
                                }
                            }
                        });
                
                        eventList += '</ul>';
                        return eventList;
                    }
                
                    function formatEvent(event) {
                        var startTime = formatTime(new Date(event.start));
                        var endTime = formatTime(new Date(event.end));
                        var venue = event.extendedProps.venue || '';
                
                        if (event.allDay) {
                            return `<li><span style="color: #fc6d6d"><b>${event.extendedProps.e_type}</b></span><br>${event.title}</li>`;
                        } else {
                            return `<li><span style="color: #fc6d6d"><b>${event.extendedProps.e_type} ${startTime} to ${endTime}</b></span><br><b>[TITLE]</b> ${event.title} <br><b>[VENUE]</b> ${venue}</li>`;
                        }
                    }
                
                    function generateCalendarLayout(days) {
                        var rows = '';
                        var dayIndex = 0;
                
                        rows += '<tr>';
                        for (var i = 0; i < firstDayIndex; i++) {
                            rows += '<td style="height: 80px;"></td>';
                            dayIndex++;
                        }
                
                        days.forEach(date => {
                            if (dayIndex % 7 === 0 && dayIndex !== 0) {
                                rows += '</tr><tr>';
                            }
                            var dayNumber = date.getDate();
                            var eventList = generateEventList(date, events);
                
                            rows += `<td style="height: 155px; line-height: 1.2;">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span style="text-align: left;">${dayNumber}</span>
                                        </div>
                                        <div>${eventList}</div>
                                     </td>`;
                            dayIndex++;
                        });
                
                        while (dayIndex % 7 !== 0) {
                            rows += '<td style="height: 80px;"></td>';
                            dayIndex++;
                        }
                
                        rows += '</tr>';
                        return rows;
                    }
                
                    var calendarLayout = generateCalendarLayout(days);
                
                    var customContent = `
                        <html>
                        <head>
                            <title>Print Preview</title>
                            <style>
                                body {
                                    font-family: Cambria, serif;
                                    font-size: 10px;
                                }
                                .content {
                                    margin: 20px;
                                }
                                table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    table-layout: fixed;
                                }
                                table, th, td {
                                    border: 1px solid black;
                                }
                                th, td {
                                    padding: 5px;
                                    text-align: left;
                                    height: 80px;
                                    width: 14.28%;
                                    vertical-align: top;
                                    word-wrap: break-word;
                                }
                                th {
                                    text-align: center;
                                    font-size: 12px;
                                }
                                th, td {
                                    font-size: 10px;
                                }
                                .content div {
                                    font-size: 10px;
                                }
                                ul {
                                    padding-left: 15px;
                                    margin: 0;
                                }
                                li {
                                    margin-bottom: 5px;
                                }
                            </style>
                        </head>
                        <body>
                            <div class="content">
                                <h1 style="font-size: 16px;">Perpetual Calendar</h1>
                                <table>
                                    <thead>
                                        <tr style="padding: 15px;">
                                            <th colspan="7" style="font-size: 16px; height: auto;">${monthName} ${currentYear}</th>
                                        </tr>
                                        <tr>
                                            <th style="height: 5px;">Sunday</th>
                                            <th style="height: 5px;">Monday</th>
                                            <th style="height: 5px;">Tuesday</th>
                                            <th style="height: 5px;">Wednesday</th>
                                            <th style="height: 5px;">Thursday</th>
                                            <th style="height: 5px;">Friday</th>
                                            <th style="height: 5px;">Saturday</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${calendarLayout}
                                    </tbody>
                                </table>
                            </div>
                        </body>
                        </html>
                    `;
                
                    var newWindow = window.open("", "_blank");
                    newWindow.document.write(customContent);
                    newWindow.document.close();
                    newWindow.onload = function() {
                        newWindow.print();
                    };
                }
            function mobilecheck() {
                var check = false;
                (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))) check = true;})(navigator.userAgent||navigator.vendor||window.opera);
                return check;
            }

            function formatDate(date) {
                var year = date.getFullYear();
                var month = ('0' + (date.getMonth() + 1)).slice(-2);
                var day = ('0' + date.getDate()).slice(-2);
                return year + '-' + month + '-' + day;
            }

            function removeEvent(event_id){
                if (confirm('Are you sure you want to remove this event?')) {
                    calendar.getEventById(event_id).remove();
                    }
                    document.getElementById('cardId_'+event_id).remove();
            }
            
            function formatTimeWithAmPm(date) {
                var hours = date.getHours();
                var period = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12 || 12; // Convert 0 to 12
                var formattedTime = ('0' + hours).slice(-2) + ':' +
                                    ('0' + date.getMinutes()).slice(-2) + ' ' + period;
                                    //':' +
                                    //('0' + date.getSeconds()).slice(-2) + ' ' + period;
                return formattedTime;
            }

            function validateDate(){
                var e_title = document.getElementById('e_title');
                var e_all_day = document.getElementById('e_all_day');
                var dateStrt = document.getElementById('e_date_from');
                var dateEnd = document.getElementById('e_date_to');
                var e_repeat = document.getElementById('e_repeat');
                var e_repeat_opt = e_repeat.getElementsByTagName("option");

                let dateObjStrt = new Date (dateStrt.value);
                let dateObjEnd = new Date (dateEnd.value);
                
                //if(e_all_day.checked){

                // Optionally, reset the value of dateEnd if it's before the new minimum date
                if (dateObjEnd < dateObjStrt) {
                    dateEnd.value = dateStrt.value;
                }

                // Set the minimum date for dateEnd input to the selected date in dateStrt
                dateEnd.min = formatDate(dateObjStrt); // Format the date

                if(dateObjStrt.toDateString() == dateObjEnd.toDateString()){
                    for (var i = 1; i < e_repeat_opt.length; i++) {
                        e_repeat_opt[i].disabled = false;
                        }
                }else{
                    e_repeat.value = "";

                    for (var i = 1; i < e_repeat_opt.length; i++) {
                        e_repeat_opt[i].disabled = true;
                    }
                }
                //}
            }

            function validateDateUpdateForm(){
                var e_title = document.getElementById('update_e_title');
                var e_all_day = document.getElementById('update_e_all_day');
                var dateStrt = document.getElementById('update_e_date_from');
                var dateEnd = document.getElementById('update_e_date_to');
                var e_repeat = document.getElementById('update_e_repeat');
                var e_repeat_opt = e_repeat.getElementsByTagName("option");
                
                let dateObjStrt = new Date (dateStrt.value);
                let dateObjEnd = new Date (dateEnd.value);
                
                //if(e_all_day.checked){

                // Optionally, reset the value of dateEnd if it's before the new minimum date
                if (dateObjEnd < dateObjStrt) {
                    dateEnd.value = dateStrt.value;
                }

                // Set the minimum date for dateEnd input to the selected date in dateStrt
                dateEnd.min = formatDate(dateObjStrt); // Format the date
                    

                    if(dateObjStrt.toDateString() == dateObjEnd.toDateString()){
                        for (var i = 1; i < e_repeat_opt.length; i++) {
                            e_repeat_opt[i].disabled = false;
                          }
                    }else{
                        e_repeat.value = "";

                        for (var i = 1; i < e_repeat_opt.length; i++) {
                                e_repeat_opt[i].disabled = true;
                              }
                    }
                //}
            }

            function fetchCalendarEvents(calendar){

                fetch(`/calendar/get-all-events`, {
                    method: 'GET',
                }).then(response => response.json())
                    .then(data => {

                        data.forEach((v, k)=>{
                            calendar.addEvent(v);
                         });

                    })
                    .catch(error => {
                        console.log(error);
                    });

                }


            function updateEvent(info){
                var startDate = new Date(info.event.start);
                var endDate = new Date(info.event.end);

                if (startDate !== endDate) {
                    endDate.setDate(endDate.getDate() - 1);
                }

                //var startDate = new Date(info.event.start);
                //var endDate = new Date(info.event.end);

                var formattedStartDate = startDate.getFullYear() + '-' +
                    ('0' + (startDate.getMonth() + 1)).slice(-2) + '-' +
                    ('0' + startDate.getDate()).slice(-2) + ' ' +
                    ('0' + startDate.getHours()).slice(-2) + ':' +
                    ('0' + startDate.getMinutes()).slice(-2) + ':' +
                    ('0' + startDate.getSeconds()).slice(-2);

                var formattedEndDate = endDate.getFullYear() + '-' +
                    ('0' + (endDate.getMonth() + 1)).slice(-2) + '-' +
                    ('0' + endDate.getDate()).slice(-2) + ' ' +
                    ('0' + endDate.getHours()).slice(-2) + ':' +
                    ('0' + endDate.getMinutes()).slice(-2) + ':' +
                    ('0' + endDate.getSeconds()).slice(-2);

                fetch(`/calendar/update-event`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}, 
                    body: JSON.stringify({
                        "id": info.event.id,
                        "start": formattedStartDate,
                        "end": formattedEndDate
                    })
                }).then((res) => {
                    if (res.status == 200) {
                        return res.json();
                    }
                });
            }
           

            document.getElementById('birthday-select').addEventListener('change', (e) => {
                document.getElementById("listOfBirthdayCelebrators").innerHTML = '';
                var birthday_pics = document.getElementById('carouselExampleControls').getElementsByClassName('carousel-inner')[0];
            
                // Clear the existing carousel content
                birthday_pics.innerHTML = '';
            
                let month = document.getElementById('birthday-select');
                fetch(`/birthday-celebrators/${month.value}`, {
                    method: 'GET',
                })
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(element => {
                            var date = new Date(element.birthdate);
                            day = date.toLocaleDateString(undefined, {
                                year: "numeric",
                                month: "2-digit",
                                day: "2-digit"
                            })
            
                            day = day.split("/")
            
                            document.getElementById("listOfBirthdayCelebrators").innerHTML += `
                                <li>${day[1]} &#8212; ${element.last_name}, ${element.first_name} ${(element.name_extn == null || element.name_extn == "N/A" || element.name_extn == "") ? "" : element.name_extn} ${(element.middle_name == null || element.middle_name == "N/A" || element.middle_name == "") ? "" : element.middle_name}</li>
                            `
            
                            var element_id = element.id;
                            var image_url = `/static/img/birthday/${day[0]}/${element_id}.png`;
            
                            // Create a new carousel item for each image
                            var carouselItem = document.createElement('div');
                            carouselItem.classList.add('carousel-item');
                            if (birthday_pics.children.length === 0) {
                                carouselItem.classList.add('active');
                            }
                            carouselItem.innerHTML = `
                                <img src="${image_url}" class="d-block w-100 h-90" alt="birthdays">
                            `;
                            birthday_pics.appendChild(carouselItem);
                        });
                    });
            });


            function countWords(text) {
                return text.split(/\s+/).filter(Boolean).length;
            }

            function toggleReadMore() {
                //var content = document.getElementById('blog-content');
                var content = document.getElementsByClassName("paragraph");
                var readMoreBtn = document.getElementById('read-more-btn');
                var readLessBtn = document.getElementById('read-less-btn');
                var valueFocus = document.getElementById('valueFocusBtn');

             if(content[0].style.maxHeight == '100%'){
                    content[0].style.maxHeight = '300px';
                    readMoreBtn.style.display = 'block';
                    readLessBtn.style.display = 'none';
                    valueFocus.click();

                
                } else {
                    content[0].style.maxHeight = '100%';
                    readMoreBtn.style.display = 'none';
                    readLessBtn.style.display = 'block';
                }
            }

        // Check if content has more than 100 words
        // var content = document.getElementById('content');
        var content = document.getElementsByClassName("paragraph");

        var readMoreBtn = document.getElementById('read-more-btn');
        if (countWords(content[0].textContent) > 40) {
            content[0].style.maxHeight = '300px';
            readMoreBtn.style.display = 'block';
        }

        
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
              if (entry.isIntersecting) {
                entry.target.classList.add('animate__animated', 'animate__fadeInUp');
              }
            });
          });
          
          // Observe elements you want to animate
          document.querySelectorAll('.your-target-class').forEach(el => {
            observer.observe(el);
          });

            window.addEventListener('load', (event) => {


                $(document).ready(function(){
                    $("#searchFormsInput").on("keyup", function() {
                      var value = $(this).val().toLowerCase();
                      $("#searchFormsList li").filter(function() {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                      });
                    });
                  });


                //old api
                //fetch('https://api.quotable.io/random?tags=inspirational',{

                fetch('https://type.fit/api/quotes',{
                    method: 'GET',
                    //body: JSON.stringify({"tags" : "inspirational, famous-quotes"})
                })
                    .then(response => response.json())
                    .then((data)=>{
                        console.log(data);
                        var idx = Math.floor(Math.random() * 16)
                        if(data[idx].text != undefined){
                            document.getElementById("quote").innerHTML = '"'+ data[idx].text +'"';
                            document.getElementById("qauthor").innerHTML = '-'+ data[idx].author;
                        }

                })

                var selectId = document.getElementById("birthday-select");

                selectId.onchange=function(){
                var selectedValue = selectId.options[selectId.selectedIndex].value; 
                var selectedText = selectId.options[selectId.selectedIndex].text;

                selectId.style.width = 75 + (selectedText.length * 8) + "px";
                }

                });
        </script>
        {% endblock %}