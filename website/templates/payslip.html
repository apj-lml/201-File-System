{% extends 'base.html' %}

{% block title %} Payslips {% endblock %}

{%block cssperfile %}
<link href="{{ url_for('static', filename='movingBg.css') }}" rel="stylesheet">
<style type="text/css">
	div.dtsb-searchBuilder div.dtsb-titleRow {
    	display: none;
}
</style>


<!-- Custom styles for this template -->

{% endblock %}

{% block content %}
<main class="container">
	<ul class="circles">
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
		<li></li>
	</ul>
  
	<div class="row mb-3 mx-auto mt-5">
		<!-- <div class="col-sm-12">
			<button class="btn btn-secondary btn-sm m-5" data-bs-toggle="modal" data-bs-target="#exampleModal">New Service Record</button>
		</div> -->
		<div class="card mb-3">
			<div class="card-body">
				<div class="card text-white bg-blue shadow-sm mb-3" >
					<div class="card-header">
						<h3 class="card-title fw-bolder text-white m-0"><i class="bi bi-wallet2"></i> PAYSLIPS</h3>
					 </div>
					<!-- <div class="card-body">
					  <ul>
					  <li><p class="card-text">Please fill out necessary field.</p></li>
					  </ul>
					  
					</div> -->
				  </div>
					
					<div class="card shadow-sm mb-3">
                            <div class="card-body">
								{% for year, months in payslips_by_year_month.items() %}
								<div class="accordion accordion" id="accordionFlushExample">
									<div class="accordion-item">
									  <h2 class="accordion-header" id="flush-headingOne">
										<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseOne" aria-expanded="false" aria-controls="flush-collapseOne">
										  {{ year }}
										</button>
									  </h2>

									  <div id="flush-collapseOne" class="accordion-collapse collapse" aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
										<div class="accordion-body">
											{% for month, payslips in months.items() %}

											<div class="accordion-flush" id="accordionPanelsStayOpenExample">
												<div class="accordion-item">
												  <h2 class="accordion-header" id="panelsStayOpen-headingOne">
													<button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
														{{ month }}
													</button>
												  </h2>
												  <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
													<div class="accordion-body">
														{% for payslip in payslips %}
														<strong>{{ payslip.filename }}</strong>

														{% endfor %}
													</div>
												  </div>
												</div>
											  </div>
												
											{% endfor %}
										</div>
									  </div>
									</div>
								  </div>
				
								{% endfor %}
								<div class="col-sm-12 text-center mt-2">
									<form id="upload_form" action="#" method="POST" enctype="multipart/form-data">
										<input type="date" name="payroll_period_from" id="payroll_period_from">
										<input type="date" name="payroll_period_to" id="payroll_period_to">
										<input type="file" name="payslipFiles" id="payslipFiles" multiple>
										<button type="submit" class="btn btn-primary">SAVE</button>
									</form>
								</div>
							</div>

                        </div>
						<!-- <h3 class="card-title">Shirt Design</h3>
						<div class="card shadow-sm mb-3">
                            <div class="card-body">
                                <div class="form-floating flex-fill mb-3 p-1">
                                    <img src="https://via.placeholder.com/300x300.png?text=SHIRT+FRONT" class="rounded float-start img-fluid shadow p-3 m-2" alt="...">
									<img src="https://via.placeholder.com/300x300.png?text=SHIRT+BACK" class="rounded img-fluid shadow p-3 m-2" alt="...">
                                  </div>
                            </div>
                        </div> -->
			</div>
		</div>
	</div>

</main>

{% endblock %}

{%block scripts%}
<script type="text/javascript">
	///ld/add-learning-and-development/{{emp_id}}
	document.getElementById('upload_form').addEventListener('submit', (e)=>{
		e.preventDefault();
		var formElem = document.getElementById("upload_form"); 
		let formData = new FormData(formElem);

		const data = {}
		formData.forEach((value, key) => (data[key] = value))
		
		console.log(data)
		fetch('/payslipControl/upload-payslips/{{user_profile.id}}', {
				method: 'POST',
				body: formData
			}).then((res)=>{
				if (res.status == 200){
					// document.getElementById('add_polo_form').reset();
				}
				return res.json();

			}).then((data)=>{
					triggerToast(data); //this is the returned error message
					window.location.reload();
			})

	});




</script>
{%endblock%}